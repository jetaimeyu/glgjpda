webpackJsonp([16],{Y2lu:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("//Fk"),a=i.n(s),o=i("Gu7T"),n=i.n(o),c=i("woOf"),r=i.n(c),l=i("Dd8w"),u=i.n(l),h=i("oqQY"),p=i.n(h),f=i("oveD"),m=i("M/Ia"),d=i("NYxO"),v=i("lzuW"),x=i("ABCa"),D=i("QHDY"),C=i("rHil"),y=i("1DHf"),w=i("pDNl"),g=i("UNGY"),P=i("7TQh"),b=i("7Ah8"),I=i("ALGc"),S=i("2sLL"),k=i("Bfwr"),_=i("rLAy"),$=i("Msp2"),M=i("2FOq"),T=i("Y52p"),A=i("aTeQ"),F=(x.a,C.a,D.a,y.a,w.a,g.a,P.a,b.a,I.a,S.a,k.a,_.a,f.a,m.a,$.a,M.a,T.a,A.a,v.a,u()({},Object(d.b)(["initDictPromise"]),{goBack:function(){window.history.go(-1)},inputCostMoney:function(t){var e=Number(t);e<0&&(e=0),this.formData.CostMoney=e.toFixed(2),e>1e10&&this.$vux.toast.show({text:"收支金额必须大于0小于10000000000",position:"middle",type:"warn"})},ifClear:function(t){0==Number(t)&&(this.formData.CostMoney="")},save:function(){var t=this,e=this.$refs.client.getData();if(this.formData.CostMoney<=0||this.formData.CostMoney>=1e10)this.$vux.toast.show({text:"收支金额必须大于0小于10000000000",position:"middle",type:"warn"});else if(this.costFormCostDate){var i=r()({},this.formData);e.CustomerID&&(i.CustomerID=e.CustomerID,i.LinkUserID=e.LinkUserID),"收入"==i.CostType&&(i.CostType=1),i.CostDate=p()(this.costFormCostDate).format("YYYY-MM-DD HH:mm:ss"),i.IsExpense=this.ifSwitch?1:0,this.$vux.loading.show({text:"提交中..."}),this.postAxios("/Cost/SaveCrmCostRecord",i).then(function(e){t.$vux.toast.show({type:"success",text:"保存成功"}),t.$bus.emit("onSave",!0),t.$bus.emit("refrechCostList",!0),setTimeout(function(){t.$vux.toast.hide(),t.$vux.loading.hide(),t.ifSave=!0,t.$route.meta.isBack=!0,t.$router.back()},500)})}else this.$vux.toast.show({text:"请选择收支日期",position:"middle",type:"warn"})},getData:function(){var t=this;this.fId&&(this.costTitle="修改费用收支",this.getAxios("/Cost/GetCrmCostRecordByID/"+this.fId).then(function(e){t.formData=u()({},e.Data),t.formData.CostDate&&(t.costFormCostDate=p()(t.formData.CostDate).format("YYYY-MM-DD")),t.formData.CostType=1==t.formData.CostType?"收入":"支出",t.ifSwitch=1==t.formData.IsExpense,t.old.CostMoney=t.formData.CostMoney,t.old.Description=t.formData.Description,t.formData.ImgAttach.forEach(function(e){e.PicPath=api50+"/api/v1/File/DownLoadPic?filePath="+e.FilePath,t.pics.push(e)})}))},goto:function(t,e){this.$router.push({path:t,query:{id:e}})},startSelectPic:function(){this.showAction=!0},chooseSelectType:function(t){this.maxPic<=0?this.$vux.toast.show({text:"最多可选9张图片",position:"middle",type:"cancel"}):"shot"==t?this.shotAndChoose():"album"==t&&this.addPic()},shotAndChoose:function(){var t=this;document.querySelector(".checkPage");this.maxPic<=0?this.$vux.toast.show({text:"最多可选9张图片",position:"middle",type:"cancel"}):plus.camera.getCamera().captureImage(function(e){e&&t.selectPic([e])})},addPic:function(){var t=this;this.maxPic<=0?this.$vux.toast.show({text:"最多可选9张图片",position:"middle",type:"cancel"}):plus.gallery.pick(function(e){t.selectPic(e.files)},function(t){console.log("取消选择图片")},{filter:"image",multiple:!0,maximum:t.maxPic,system:!1})},selectPic:function(t){this.uploadPic(t)},uploadPic:function(t){var e=this,i=this,s=this.BillFileUrl(1),o=plus.nativeUI.showWaiting();o.close();for(var c=plus.uploader.createUpload(s,{method:"POST"},function(t,e){if(200==e){var s;i.$vux.loading.hide(),o.close();var a=JSON.parse(t.responseText);if(1!=a.State)return i.$vux.toast.show({text:a.ErrorMessage,position:"middle",type:"cancel"}),!1;a.Data.forEach(function(t){t.PicPath=api50+"/api/v1/File/DownLoadPIc?filePath="+t.FilePath,i.pics.push({src:t.PicPath})}),a.Data.map(function(t){t.FileSize=100,t.FileType=1}),(s=i.formData.ImgAttach).push.apply(s,n()(a.Data))}else alert("上传失败！")}),r=[],l=0;l<t.length;l++){var u=t[l];r.push(this.zipPic(u,l))}c.addEventListener("statechanged",function(t,i){if(t.totalSize>10485760)return e.$vux.toast.show({type:"warn",text:"图片大小不超过10M"}),c.abort(),!1;0},!1),a.a.all(r).then(function(t){for(var e=0;e<t.length;e++)c.addFile(t[e].path,{key:t[e].name})}).then(function(){c.start()})},zipPic:function(t,e){return new a.a(function(i,s){var a=new RegExp("(.{"+t.lastIndexOf(".")+"})"),o=t.replace(a,"$1_zip"),n=o.substr(o.lastIndexOf(".")+1,o.length-o.lastIndexOf(".")),c=o.substr(0,o.lastIndexOf("/")+1)+e+"."+n,r=c.substr(c.lastIndexOf("/")+1,c.length-c.lastIndexOf("/"));plus.zip.compressImage({src:t,dst:c,overwrite:!0,width:"50%",quality:60},function(t){i({path:t.target,name:r})},function(t){s(t)})})},removePic:function(t){this.formData.ImgAttach.splice(t,1),this.pics.splice(t,1)}}),u()({},Object(d.e)(["dict"]),{maxPic:function(){return 9-this.formData.ImgAttach.length}}),{name:"newCost",components:{XHeader:x.a,Group:C.a,Radio:D.a,Cell:y.a,XInput:w.a,Datetime:g.a,PopupRadio:P.a,PopupPicker:b.a,XTextarea:I.a,XButton:S.a,Loading:k.a,Toast:_.a,Dict:f.a,ClientLink:m.a,Actionsheet:$.a,Previewer:M.a,XImg:T.a,XSwitch:A.a},mixins:[v.a],data:function(){return{costTypeList:[{key:"1",value:"收入"},{key:"2",value:"支出"}],formData:{ID:0,CostType:"收入",OrderID:0,CostDate:"",CustomerID:0,CustomerName:"",LinkUserID:"",LinkUserName:"",Description:"",CostClassID:"",CostTypeName:"",Remark:"",CostMoney:"",ReturnID:0,ImgAttach:[]},ifSwitch:!0,old:{CostMoney:"",Description:""},change:!1,changeForm:[],costFormCostDate:p()(new Date).format("YYYY-MM-DD"),fId:"",cId:"",cLink:"",isSelectCust:!0,costTitle:"新建费用收支",docmHeight:document.documentElement.clientHeight,showHeight:document.documentElement.clientHeight,submitShow:!0,ifSave:!1,options:{saveImg:function(t){console.log(t)}},showAction:!1,actionMenu:{shot:"拍照",album:"从相册选择"},pics:[]}},methods:u()({},Object(d.b)(["initDictPromise"]),{goBack:function(){window.history.go(-1)},inputCostMoney:function(t){var e=Number(t);e<0&&(e=0),this.formData.CostMoney=e.toFixed(2),e>1e10&&this.$vux.toast.show({text:"收支金额必须大于0小于10000000000",position:"middle",type:"warn"})},ifClear:function(t){0==Number(t)&&(this.formData.CostMoney="")},save:function(){var t=this,e=this.$refs.client.getData();if(this.formData.CostMoney<=0||this.formData.CostMoney>=1e10)this.$vux.toast.show({text:"收支金额必须大于0小于10000000000",position:"middle",type:"warn"});else if(this.costFormCostDate){var i=r()({},this.formData);e.CustomerID&&(i.CustomerID=e.CustomerID,i.LinkUserID=e.LinkUserID),"收入"==i.CostType&&(i.CostType=1),i.CostDate=p()(this.costFormCostDate).format("YYYY-MM-DD HH:mm:ss"),i.IsExpense=this.ifSwitch?1:0,this.$vux.loading.show({text:"提交中..."}),this.postAxios("/Cost/SaveCrmCostRecord",i).then(function(e){t.$vux.toast.show({type:"success",text:"保存成功"}),t.$bus.emit("onSave",!0),t.$bus.emit("refrechCostList",!0),setTimeout(function(){t.$vux.toast.hide(),t.$vux.loading.hide(),t.ifSave=!0,t.$route.meta.isBack=!0,t.$router.back()},500)})}else this.$vux.toast.show({text:"请选择收支日期",position:"middle",type:"warn"})},getData:function(){var t=this;this.fId&&(this.costTitle="修改费用收支",this.getAxios("/Cost/GetCrmCostRecordByID/"+this.fId).then(function(e){t.formData=u()({},e.Data),t.formData.CostDate&&(t.costFormCostDate=p()(t.formData.CostDate).format("YYYY-MM-DD")),t.formData.CostType=1==t.formData.CostType?"收入":"支出",t.ifSwitch=1==t.formData.IsExpense,t.old.CostMoney=t.formData.CostMoney,t.old.Description=t.formData.Description,t.formData.ImgAttach.forEach(function(e){e.PicPath=api50+"/api/v1/File/DownLoadPic?filePath="+e.FilePath,t.pics.push(e)})}))},goto:function(t,e){this.$router.push({path:t,query:{id:e}})},startSelectPic:function(){this.showAction=!0},chooseSelectType:function(t){this.maxPic<=0?this.$vux.toast.show({text:"最多可选9张图片",position:"middle",type:"cancel"}):"shot"==t?this.shotAndChoose():"album"==t&&this.addPic()},shotAndChoose:function(){var t=this;document.querySelector(".checkPage");this.maxPic<=0?this.$vux.toast.show({text:"最多可选9张图片",position:"middle",type:"cancel"}):plus.camera.getCamera().captureImage(function(e){e&&t.selectPic([e])})},addPic:function(){var t=this;this.maxPic<=0?this.$vux.toast.show({text:"最多可选9张图片",position:"middle",type:"cancel"}):plus.gallery.pick(function(e){t.selectPic(e.files)},function(t){console.log("取消选择图片")},{filter:"image",multiple:!0,maximum:t.maxPic,system:!1})},selectPic:function(t){this.uploadPic(t)},uploadPic:function(t){var e=this,i=this,s=this.BillFileUrl(1),o=plus.nativeUI.showWaiting();o.close();for(var c=plus.uploader.createUpload(s,{method:"POST"},function(t,e){if(200==e){var s;i.$vux.loading.hide(),o.close();var a=JSON.parse(t.responseText);if(1!=a.State)return i.$vux.toast.show({text:a.ErrorMessage,position:"middle",type:"cancel"}),!1;a.Data.forEach(function(t){t.PicPath=api50+"/api/v1/File/DownLoadPIc?filePath="+t.FilePath,i.pics.push({src:t.PicPath})}),a.Data.map(function(t){t.FileSize=100,t.FileType=1}),(s=i.formData.ImgAttach).push.apply(s,n()(a.Data))}else alert("上传失败！")}),r=[],l=0;l<t.length;l++){var u=t[l];r.push(this.zipPic(u,l))}c.addEventListener("statechanged",function(t,i){if(t.totalSize>10485760)return e.$vux.toast.show({type:"warn",text:"图片大小不超过10M"}),c.abort(),!1;0},!1),a.a.all(r).then(function(t){for(var e=0;e<t.length;e++)c.addFile(t[e].path,{key:t[e].name})}).then(function(){c.start()})},zipPic:function(t,e){return new a.a(function(i,s){var a=new RegExp("(.{"+t.lastIndexOf(".")+"})"),o=t.replace(a,"$1_zip"),n=o.substr(o.lastIndexOf(".")+1,o.length-o.lastIndexOf(".")),c=o.substr(0,o.lastIndexOf("/")+1)+e+"."+n,r=c.substr(c.lastIndexOf("/")+1,c.length-c.lastIndexOf("/"));plus.zip.compressImage({src:t,dst:c,overwrite:!0,width:"50%",quality:60},function(t){i({path:t.target,name:r})},function(t){s(t)})})},removePic:function(t){this.formData.ImgAttach.splice(t,1),this.pics.splice(t,1)}}),watch:{showHeight:function(){this.docmHeight>this.showHeight?this.submitShow=!1:this.submitShow=!0}},computed:u()({},Object(d.e)(["dict"]),{maxPic:function(){return 9-this.formData.ImgAttach.length}}),beforeRouteLeave:function(t,e,i){var s=this.old.CostMoney!=this.formData.CostMoney||this.old.Description!=this.formData.Description;this.ifSave?(t.meta.keepAlive=!1,i()):s?this.$vux.confirm.show({title:"继续退出?",content:"您已编辑过，退出将丢失这些内容!",onCancel:function(){i(!1)},onConfirm:function(){i()}}):i()},mounted:function(){var t=this,e=this.$route.query;this.fId=e.id,e.cId&&(this.isSelectCust=!1,this.cId=e.cId,this.cLink=e.cLink,this.formData.CustomerID=this.cId,this.formData.CustomerName=e.cName,this.formData.LinkUserID=this.cLink),this.getData(),window.onresize=function(){t.showHeight=document.body.clientHeight}}}),L={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("transition",{attrs:{name:"slide"}},[i("div",{staticClass:"costform"},[i("x-header",{attrs:{"left-options":{backText:""}}},[t._v(t._s(t.costTitle)+"\n      ")]),t._v(" "),i("group",{staticClass:"addspace"},[i("cell",{staticClass:"cell-title"},[i("span",{attrs:{slot:"title"},slot:"title"},[t._v("收支类型")])]),t._v(" "),i("div",{staticStyle:{"border-top":"1px solid #eee"}},[i("popup-radio",{attrs:{title:"类型",placeholder:"请选收支类型",options:t.costTypeList},model:{value:t.formData.CostType,callback:function(e){t.$set(t.formData,"CostType",e)},expression:"formData.CostType"}},[i("span",{staticStyle:{color:"#f00"},attrs:{slot:"icon"},slot:"icon"},[t._v("*")]),t._v(" "),i("p",{staticClass:"radioTitle",attrs:{slot:"popup-header"},slot:"popup-header"},[t._v("选择收支类型")])])],1),t._v(" "),i("div",{staticClass:"form-item"},[i("x-input",{attrs:{type:"number","text-align":"right"},on:{"on-blur":t.inputCostMoney,"on-focus":t.ifClear},model:{value:t.formData.CostMoney,callback:function(e){t.$set(t.formData,"CostMoney",e)},expression:"formData.CostMoney"}},[i("span",{attrs:{slot:"label"},slot:"label"},[i("span",{staticStyle:{color:"red"}},[t._v("*")]),t._v("金额")])])],1),t._v(" "),2==this.formData.CostType?i("div",{staticClass:"form-item"},[i("x-switch",{attrs:{title:"是否报销"},model:{value:t.ifSwitch,callback:function(e){t.ifSwitch=e},expression:"ifSwitch"}})],1):t._e()],1),t._v(" "),i("group",{staticClass:"delspace",attrs:{"label-width":"4.5em","label-margin-top":"0.3em"}},[i("cell",{staticClass:"cell-title",attrs:{title:"收支信息"}}),t._v(" "),i("div",{staticStyle:{"border-top":"1px solid #eee"}},[i("datetime",{attrs:{placeholder:"请选择收支日期"},model:{value:t.costFormCostDate,callback:function(e){t.costFormCostDate=e},expression:"costFormCostDate"}},[i("span",{attrs:{slot:"title"},slot:"title"},[i("span",{staticStyle:{color:"red"}},[t._v("*")]),t._v("收支日期")])])],1),t._v(" "),i("div",{staticClass:"form-item"},[i("dict",{attrs:{type:"22",title:"费用名称",placeholder:"请选择费用名称"},model:{value:t.formData.CostClassID,callback:function(e){t.$set(t.formData,"CostClassID",e)},expression:"formData.CostClassID"}})],1),t._v(" "),i("ClientLink",{ref:"client",attrs:{workRu:!1,isSelect:t.isSelectCust,data:t.formData,path:"newCost/selectCust"}}),t._v(" "),i("div",{staticClass:"form-item flex"},[i("div",{staticStyle:{flex:"1",padding:"10px 15px","font-size":"14px"}},[t._v("说明")]),t._v(" "),i("div",{staticStyle:{flex:"3"}},[i("x-textarea",{attrs:{max:250},model:{value:t.formData.Description,callback:function(e){t.$set(t.formData,"Description",e)},expression:"formData.Description"}})],1)]),t._v(" "),i("div",{staticClass:"form-item flex",on:{click:t.startSelectPic}},[i("div",{staticStyle:{flex:"1",padding:"10px 15px","font-size":"14px"}},[t._v("上传图片(最多选9张)")]),t._v(" "),i("svg",{staticClass:"vux-x-icon vux-x-icon-ios-plus-outline",staticStyle:{fill:"#666","margin-top":"3px"},attrs:{type:"ios-plus-outline",size:"30",xmlns:"http://www.w3.org/2000/svg",width:"30",height:"30",viewBox:"0 0 512 512"}},[i("path",{attrs:{d:"M256 48C141.1 48 48 141.1 48 256s93.1 208 208 208 208-93.1 208-208S370.9 48 256 48zm0 398.7c-105.1 0-190.7-85.5-190.7-190.7S150.9 65.3 256 65.3 446.7 150.9 446.7 256 361.1 446.7 256 446.7z"}}),i("path",{attrs:{d:"M264.1 128h-16.8v119.9H128v16.8h119.3V384h16.8V264.7H384v-16.8H264.1z"}})])]),t._v(" "),i("div",{staticClass:"pictureBox"},t._l(t.formData.ImgAttach,function(e,s){return i("div",{key:s,staticClass:"flexPic"},[i("svg",{staticClass:"vux-x-icon vux-x-icon-ios-close closeX",attrs:{type:"ios-close",size:"25",id:"Layer_1",xmlns:"http://www.w3.org/2000/svg",width:"25",height:"25",viewBox:"0 0 512 512"},on:{click:function(e){t.removePic(s)}}},[i("path",{staticClass:"st0",attrs:{d:"M403.1 108.9c-81.2-81.2-212.9-81.2-294.2 0s-81.2 212.9 0 294.2c81.2 81.2 212.9 81.2 294.2 0s81.2-213 0-294.2zM352 340.2L340.2 352l-84.4-84.2-84 83.8-11.8-11.8 84-83.8-84-83.8 11.8-11.8 84 83.8 84.4-84.2 11.8 11.8-84.4 84.2 84.4 84.2z"}})]),t._v(" "),i("x-img",{staticStyle:{height:"100px",width:"100px"},attrs:{src:e.PicPath},nativeOn:{click:function(e){t.imgShowPic(s)}}})],1)}))],1),t._v(" "),i("div",[i("router-view",{staticClass:"selectCust"})],1),t._v(" "),i("div",{staticStyle:{position:"fixed",bottom:"0px",width:"100%"}},[i("x-button",{attrs:{type:"primary"},nativeOn:{click:function(e){return t.save(e)}}},[t._v("提交")])],1),t._v(" "),i("previewer",{ref:"previewer",attrs:{list:t.pics,options:t.options},on:{"on-close":t.closePic}}),t._v(" "),i("actionsheet",{attrs:{menus:t.actionMenu,"show-cancel":""},on:{"on-click-menu":t.chooseSelectType},model:{value:t.showAction,callback:function(e){t.showAction=e},expression:"showAction"}})],1)])},staticRenderFns:[]};var O=i("VU/8")(F,L,!1,function(t){i("nhQF")},"data-v-ec1ac67e",null);e.default=O.exports},aTeQ:function(t,e,i){"use strict";var s=i("kbG3"),a=i("wmxo"),o=(s.a,String,Boolean,Boolean,String,Number,String,Boolean,Number,Boolean,Array,{name:"x-switch",components:{InlineDesc:s.a},computed:{labelStyle:function(){var t=/<\/?[^>]*>/.test(this.title),e=Math.min(t?5:this.title.length+1,14)+"em";return Object(a.a)({display:"block",width:this.$parent.labelWidth||e,textAlign:this.$parent.labelAlign})},labelClass:function(){return{"vux-cell-justify":this.$parent&&"justify"===this.$parent.labelAlign}}},methods:{onClick:function(){this.$emit("on-click",!this.currentValue,this.currentValue)},toBoolean:function(t){return this.valueMap?1===this.valueMap.indexOf(t):t},toRaw:function(t){return this.valueMap?this.valueMap[t?1:0]:t}},props:{title:{type:String,required:!0},disabled:Boolean,value:{type:[Boolean,String,Number],default:!1},inlineDesc:[String,Boolean,Number],preventDefault:Boolean,valueMap:{type:Array,default:function(){return[!1,!0]}}},data:function(){return{currentValue:this.toBoolean(this.value)}},watch:{currentValue:function(t){var e=this.toRaw(t);this.$emit("input",e),this.$emit("on-change",e)},value:function(t){this.currentValue=this.toBoolean(t)}}}),n={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"vux-x-switch weui-cell weui-cell_switch"},[i("div",{staticClass:"weui-cell__bd"},[i("label",{staticClass:"weui-label",class:t.labelClass,style:t.labelStyle,domProps:{innerHTML:t._s(t.title)}}),t._v(" "),t.inlineDesc?i("inline-desc",[t._v(t._s(t.inlineDesc))]):t._e()],1),t._v(" "),i("div",{staticClass:"weui-cell__ft"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.currentValue,expression:"currentValue"}],staticClass:"weui-switch",attrs:{type:"checkbox",disabled:t.disabled},domProps:{checked:Array.isArray(t.currentValue)?t._i(t.currentValue,null)>-1:t.currentValue},on:{change:function(e){var i=t.currentValue,s=e.target,a=!!s.checked;if(Array.isArray(i)){var o=t._i(i,null);s.checked?o<0&&(t.currentValue=i.concat([null])):o>-1&&(t.currentValue=i.slice(0,o).concat(i.slice(o+1)))}else t.currentValue=a}}}),t._v(" "),t.preventDefault?i("div",{staticClass:"vux-x-switch-overlay",on:{click:t.onClick}}):t._e()])])},staticRenderFns:[]};var c=i("VU/8")(o,n,!1,function(t){i("naU7")},null,null);e.a=c.exports},naU7:function(t,e){},nhQF:function(t,e){}});
//# sourceMappingURL=16.0acfd940e66921cc0593.js.map