webpackJsonp([8],{"1XKH":function(t,e){},"2m5j":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});a("P5JR");var s=a("hZR2"),o={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"new-order"},[a("x-header",{attrs:{"left-options":{preventGoBack:!1}}},[t._v("新建成交订单\n  ")]),t._v(" "),a("div",{staticClass:"content"},[a("Group",[a("XInput",{attrs:{title:"订单编号",value:"自动生成",disabled:""}}),t._v(" "),a("XInput",{attrs:{title:"主题",max:50},model:{value:t.form.Title,callback:function(e){t.$set(t.form,"Title",e)},expression:"form.Title"}}),t._v(" "),a("cell",{directives:[{name:"show",rawName:"v-show",value:t.isSelectCust,expression:"isSelectCust"}],staticClass:"max-width70",attrs:{title:"选择客户",value:t.CustomerName,"is-link":"请选择客户"==t.CustomerName},nativeOn:{click:function(e){t.$router.push("/order/selectCust")}}},[a("span",{staticStyle:{color:"red"},attrs:{slot:"icon"},slot:"icon"},[t._v("*")])]),t._v(" "),a("cell",{directives:[{name:"show",rawName:"v-show",value:!t.isSelectCust,expression:"!isSelectCust"}],staticClass:"max-width70",attrs:{title:"选择客户",value:t.CustomerName}},[a("span",{staticStyle:{color:"red"},attrs:{slot:"icon"},slot:"icon"},[t._v("*")])]),t._v(" "),a("popup-picker",{attrs:{"show-name":!0,title:"联系人",placeholder:"请选择联系人",data:t.cLinkman,show:t.isUserShow},on:{"on-change":function(e){return t.LinkUserID=e[0]}},nativeOn:{click:function(e){return t.beforeShow(e)}},model:{value:t.LinkUser,callback:function(e){t.LinkUser=e},expression:"LinkUser"}},[a("div",{staticClass:"label",style:{width:this.width+"px"},attrs:{slot:"title"},slot:"title"},[a("span",{staticStyle:{color:"red"},attrs:{slot:"icon"},slot:"icon"},[t._v("*")]),t._v("联系人\n        ")])]),t._v(" "),a("cell",{staticClass:"max-width90",attrs:{title:"选择抄送人",value:t.sendersName,"is-link":""},nativeOn:{click:function(e){t.userShow=!0}}}),t._v(" "),a("user-select",{attrs:{show:t.userShow,title:"选择抄送人",defaultUser:t.checkVal},on:{save:t.userSelected,close:function(e){t.userShow=!1}}}),t._v(" "),a("cell",{attrs:{title:"选择成交产品",value:"","is-link":"",link:t.parentPath+"/chooseProduct"}},[a("span",{staticStyle:{color:"red"},attrs:{slot:"icon"},slot:"icon"},[t._v("*")])]),t._v(" "),a("div",{staticClass:"product-list"},t._l(t.getChooseProductData,function(e,s){return a("div",{staticClass:"product-list-item"},[a("svg",{staticClass:"vux-x-icon vux-x-icon-ios-minus close",attrs:{type:"ios-minus",size:"25",xmlns:"http://www.w3.org/2000/svg",width:"25",height:"25",viewBox:"0 0 512 512"},on:{click:function(e){e.stopPropagation(),t.delProduct(s)}}},[a("path",{attrs:{d:"M256 48C141.1 48 48 141.1 48 256s93.1 208 208 208 208-93.1 208-208S370.9 48 256 48zm128 217H128v-17h256v17z"}})]),t._v(" "),a("x-input",{attrs:{title:"产品名称:",value:e.ProdName,disabled:""}}),t._v(" "),a("x-input",{attrs:{title:"销售单价",value:e.DealPrice,disabled:""}}),t._v(" "),a("div",{staticClass:"dealnum"},[a("span",[t._v("销售数量")]),t._v(" "),a("input",{attrs:{type:"number",max:"1000000"},domProps:{value:e.DealNum},on:{blur:function(a){t.changeDealNum(a,e,s)}}})]),t._v(" "),a("x-input",{staticClass:"remark",attrs:{title:"备注",max:30},model:{value:e.Remark,callback:function(a){t.$set(e,"Remark",a)},expression:"item.Remark"}})],1)})),t._v(" "),a("Datetime",{attrs:{format:"YYYY-MM-DD",title:"成交/签约时间"},model:{value:t.form.DealDate,callback:function(e){t.$set(t.form,"DealDate",e)},expression:"form.DealDate"}},[a("p",{attrs:{slot:"title"},slot:"title"},[a("span",{staticStyle:{color:"red"},attrs:{slot:"icon"},slot:"icon"},[t._v("*")]),t._v("\n          成交/签约时间\n        ")])]),t._v(" "),a("Datetime",{attrs:{format:"YYYY-MM-DD",title:"有效期开始时间"},model:{value:t.form.BeginDate,callback:function(e){t.$set(t.form,"BeginDate",e)},expression:"form.BeginDate"}},[a("p",{attrs:{slot:"title"},slot:"title"},[a("span",{staticStyle:{color:"red"},attrs:{slot:"icon"},slot:"icon"},[t._v("*")]),t._v("\n          有效期开始时间\n        ")])]),t._v(" "),a("Datetime",{attrs:{format:"YYYY-MM-DD",title:"有效期结束时间"},model:{value:t.form.EndDate,callback:function(e){t.$set(t.form,"EndDate",e)},expression:"form.EndDate"}},[a("p",{attrs:{slot:"title"},slot:"title"},[a("span",{staticStyle:{color:"red"},attrs:{slot:"icon"},slot:"icon"},[t._v("*")]),t._v("\n          有效期结束时间\n        ")])]),t._v(" "),a("popup-picker",{attrs:{title:"选择付款方式",data:t.payment,"popup-title":"选择付款方式"},model:{value:t.payMethod,callback:function(e){t.payMethod=e},expression:"payMethod"}}),t._v(" "),a("dict",{ref:"OrderState",attrs:{title:"选择订单状态",type:"20",data:t.form.OrderState},on:{"update:data":function(e){t.$set(t.form,"OrderState",e)}}}),t._v(" "),a("x-textarea",{attrs:{max:200,title:"说明"},model:{value:t.form.Remark,callback:function(e){t.$set(t.form,"Remark",e)},expression:"form.Remark"}}),t._v(" "),a("dict",{ref:"CustState",attrs:{title:"更新客户状态",type:"5",data:t.form.CustState,defaultValue:t.form.CustStateName},on:{"update:data":function(e){t.$set(t.form,"CustState",e)}}}),t._v(" "),a("cell",{attrs:{title:"上传图片","is-link":""},nativeOn:{click:function(e){return t.selectPic(e)}}},[a("i",{staticClass:"flex-1 iconfont icon-zhaopian"})])],1),t._v(" "),a("div",{staticClass:"updatePic flex"},t._l(t.imgFile,function(e,s){return a("div",{key:s,staticClass:"picBoxWrap"},[a("div",{staticClass:"picBox"},[a("img",{attrs:{src:t._f("picUrl")(e.FilePath)},on:{click:function(e){t.imgShowPic(s)}}})]),t._v(" "),a("svg",{staticClass:"vux-x-icon vux-x-icon-ios-minus close",attrs:{type:"ios-minus",size:"25",xmlns:"http://www.w3.org/2000/svg",width:"25",height:"25",viewBox:"0 0 512 512"},on:{click:function(e){t.delPic(t.value,s)}}},[a("path",{attrs:{d:"M256 48C141.1 48 48 141.1 48 256s93.1 208 208 208 208-93.1 208-208S370.9 48 256 48zm128 217H128v-17h256v17z"}})])])})),t._v(" "),a("previewer",{ref:"previewer",attrs:{list:t.imgFile,options:t.options},on:{"on-close":t.closePic},scopedSlots:t._u([{key:"button-after",fn:function(e){return[a("i",{staticClass:"iconfont icon-iconset0237",staticStyle:{"font-size":"20px",color:"#BFBFBF","line-height":"44px","margin-left":"10px"},on:{click:function(e){e.preventDefault(),e.stopPropagation(),t.saveImg()}}})]}}])}),t._v(" "),a("div",{staticClass:"footer"},[a("span",[t._v("订单总额:")]),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.form.TotalPrice,expression:"form.TotalPrice"}],domProps:{value:t.form.TotalPrice},on:{blur:t.formatTotalPrice,input:function(e){e.target.composing||t.$set(t.form,"TotalPrice",e.target.value)}}}),t._v(" "),a("button",{on:{click:t.saveOrder}},[t._v("保存订单")])])],1),t._v(" "),a("router-view")],1)},staticRenderFns:[]};var i=function(t){a("en8I")},r=a("VU/8")(s.a,o,!1,i,"data-v-4a798b41",null);e.default=r.exports},AcdC:function(t,e,a){"use strict";(function(t){a("7Ah8").a}).call(e,a("mtWM"))},FL0N:function(t,e,a){"use strict";(function(t){var s=a("7Ah8");e.a={name:"Dict",components:{PopupPicker:s.a},props:{title:{default:"选择器"},type:{default:"4"},dictId:{default:0},defaultValue:{default:""},data:{default:function(){return{}}}},data:function(){return{value:[""],dict:{},list:[[""]],allList:[]}},mounted:function(){this.initData()},activated:function(){this.initData()},watch:{defaultValue:function(t){this.$set(this.value,0,t)}},methods:{initData:function(){var e=this;t.get("/Common/GetPagedPubDictionaryList?dicType="+this.type+"&page=1&count=100").then(function(t){if(1===t.data.State){e.list[0]=[],22==e.type&&t.data.Data.List.forEach(function(e){0==e.CompID&&t.data.Data.List.splice(e,1)}),e.allList=t.data.Data.List;var a=[];t.data.Data.List.forEach(function(t){a.push(t.DictName)}),e.$set(e.list,0,a),""!=e.defaultValue?e.$set(e.value,0,e.defaultValue):e.$set(e.value,0,t.data.Data.List[0].DictName),e.allList.some(function(t){if(t.DictName===e.value[0])return e.$emit("update:data",t),!0})}}).catch(function(t){console.log(t),e.$vux.toast.show({text:"网络异常",type:"warn"})})},cleanValue:function(){this.$set(this.value,0,this.allList[0].DictName)},onShow:function(){},onHide:function(){var t=this;this.allList.some(function(e){if(e.DictName===t.value[0])return t.$emit("update:data",e),!0})},onChange:function(t){},getDict:function(){return this.dict}}}}).call(e,a("mtWM"))},HAL1:function(t,e){},P5JR:function(t,e,a){"use strict";(function(t){var e,s=a("bOdI"),o=a.n(s),i=a("//Fk"),r=a.n(i),n=a("Dd8w"),u=a.n(n),c=a("ABCa"),l=a("rHil"),h=a("pDNl"),m=a("1DHf"),f=a("pTXB"),d=a("UNGY"),v=a("7Ah8"),p=a("ALGc"),D=a("2sLL"),w=a("2FOq"),C=a("NYxO"),x=a("yZFb"),k=a("BPFO"),g=a("lzuW"),y=a("oqQY"),S=a.n(y);g.a,k.a,c.a,l.a,h.a,m.a,f.a,d.a,x.a,v.a,p.a,D.a,w.a,Boolean,u()({},Object(C.c)(["getChooseProductData","getChooseCustomer"]),Object(C.e)(["chooseProductData","chooseCustomer","chooseLinkMan"])),u()({},Object(C.d)(["setChooseCustomer","setChooseLinkMan","setChooseProduct"]),(e={userSelected:function(t){var e=this;this.senders=[],this.sendersName="",t.forEach(function(a){e.senders.push({UserID:a.ID,IsDelete:0,ID:0}),t.length<2?e.sendersName+=a.OrgName:e.sendersName+=a.OrgName+","}),this.checkVal=t.map(function(t){return{UserID:t.ID,Name:t.OrgName}}),this.userShow=!1},formatTotalPrice:function(){this.form.TotalPrice=parseFloat((this.form.TotalPrice+"").replace(/[^\d.]/g,"")).toFixed(2)},changeDealNum:function(t,e,a){var s=this;this.$store.state.chooseProductData.forEach(function(a,o){e.ID==a.ID&&(s.$store.state.chooseProductData[o].DealNum=parseInt(t.target.value))})},getTotalPrice:function(){var t=0;this.productList.forEach(function(e){(""==e.DealNum||isNaN(e.DealNum))&&(e.DealNum=0),t+=e.DealPrice*parseInt(e.DealNum)}),this.form.TotalPrice=t.toFixed(2)},beforeShow:function(){if(!this.CustomerID)return this.$vux.toast.show({type:"warn",text:"请先选择客户"}),this.isUserShow=!1,!1;this.isUserShow=!0},saveOrder:function(){var e=this;this.form.TotalPrice=parseFloat((this.form.TotalPrice+"").replace(/[^\d.]/g,"")).toFixed(2);var a="";if(this.payment[0].some(function(t,s){if(t===e.payMethod[0])return a=s+1+"",!0}),this.areyouok){if(this.areyouok=!1,!this.CustomerID)return this.$vux.toast.show({type:"warn",text:"请选择客户"}),void(this.areyouok=!0);if(0===this.LinkUser.length)return this.$vux.toast.show({type:"warn",text:"请选择联系人"}),void(this.areyouok=!0);if(0==this.chooseProductData.length)return this.$vux.toast.show({type:"warn",text:"请选择产品"}),void(this.areyouok=!0);if(""==this.form.DealDate)return this.$vux.toast.show({type:"warn",text:"请选择签约时间"}),void(this.areyouok=!0);if(""==this.form.BeginDate)return this.$vux.toast.show({type:"warn",text:"请选择开始时间"}),void(this.areyouok=!0);if(""==this.form.EndDate)return this.$vux.toast.show({type:"warn",text:"请选择结束时间"}),void(this.areyouok=!0);if(S()(this.form.BeginDate).unix()>S()(this.form.EndDate).unix())return this.$vux.toast.show({type:"warn",text:"开始时间不能大于结束时间"}),void(this.areyouok=!0);if(""===this.form.OrderState||void 0==this.form.OrderState)return this.$vux.toast.show({type:"warn",text:"请选择订单状态"}),void(this.areyouok=!0);if(""===this.form.CustState||void 0==this.form.CustState)return this.$vux.toast.show({type:"warn",text:"请选择客户状态"}),void(this.areyouok=!0);var s=[],o=!0,i=!0;if(this.chooseProductData.forEach(function(t){(parseInt(t.DealNum)<=0||""==t.DealNum)&&(o=!1),parseInt(t.DealNum)>=1e7&&(i=!1),s.push({ID:0,OrderProdID:t.ID,DealNum:t.DealNum,DealPrice:t.DealPrice,Remark:t.Remark})}),!o)return this.$vux.toast.show({type:"warn",text:"产品数量必须大于0"}),void(this.areyouok=!0);if(!i)return this.$vux.toast.show({type:"warn",text:"产品数量必须小于10000000"}),void(this.areyouok=!0);if(parseFloat(this.form.TotalPrice)<=0)return this.$vux.toast.show({type:"warn",text:"成交总额必须大于0"}),void(this.areyouok=!0);if(parseFloat(this.form.TotalPrice)>=1e10)return this.$vux.toast.show({type:"warn",text:"成交总额必须小于10000000000"}),void(this.areyouok=!0);var r={ID:0,IsAutoNumber:1,CustomerState:this.form.CustState.ID,Title:this.form.Title,Remark:this.form.Remark,ClientID:this.CustomerID,CustomerID:this.CustomerID,LinkUserID:this.LinkUser[0],CustomerName:this.CustomerName,BeginDate:this.form.BeginDate+" 00:00:00",EndDate:this.form.EndDate+" 00:00:00",DealDate:this.form.DealDate+" 00:00:00",PayType:a,OrderNumber:"",TotalPrice:this.form.TotalPrice,OrderState:this.form.OrderState.ID,Prods:s,ImgAttach:this.imgFile,Senders:this.senders};t.post("/Order/SaveOrder",r).then(function(t){if(1===t.data.State){e.$vux.toast.show({text:"保存成功",type:"success"});var a=[];e.senders.forEach(function(t){a.push(t.UserID)}),a.length>0&&e.send(a,t.data.Data),e.goBackAndClean=!1,e.$bus.emit("onSave",!0),e.$bus.emit("refreshOrderList"),setTimeout(function(){e.form.Title="",e.setChooseProduct([]),e.form.DealDate="",e.form.BeginDate="",e.form.EndDate="",e.payMethod[0]=e.payment[0][0],e.form.CustState=[],e.form.Remark="",e.form.OrderState=[],e.form.TotalPrice=0,e.imgFile=[],e.CustomerName="请选择客户",e.CustomerID="",e.LinkUserID=[],e.cLinkman=[],e.LinkUser=[],e.form.CustStateName="",e.$refs.OrderState.cleanValue(),e.$refs.CustState.cleanValue(),e.$router.back(),e.areyouok=!0,e.$vux.toast.hide()},500)}else e.areyouok=!0,e.$vux.toast.show({text:t.data.ErrorMessage,type:"warn"})}).catch(function(t){e.$vux.toast.show({text:"网络异常",type:"warn"})})}},send:function(t,e){var a=this;t.forEach(function(e,s){e==a.$store.state.CurrentUserID&&t.splice(s,1)});var s={SendUsers:t,EvName:"crm-order",ImgPath:down+"/mdtcrm/CRMOrder.jpg",Title:"订单",Content:"您有一个新的订单",Params:[e]};this.postAxios(api50+"/api/v1/Common/SendSingleEventMsg",s).then(function(t){console.log(t)})}},o()(e,"send",function(t,e){var a=this;t.forEach(function(e,s){e==a.$store.state.CurrentUserID&&t.splice(s,1)});var s={SendUsers:t,EvName:"crm-order",ImgPath:down+"/mdtcrm/CRMOrder.jpg",Title:"订单",Content:"您有一个新的订单",Params:[e]};this.postAxios(api50+"/api/v1/Common/SendSingleEventMsg",s).then(function(t){console.log(t)})}),o()(e,"showUser",function(){this.chooseCustomer.ID&&this.$router.push("/selectLinkman?id="+this.chooseCustomer.ID)}),o()(e,"selectPic",function(){var t=this;if(this.imgFile.length>=5)return this.$vux.toast.show({type:"warn",text:"最多上传五张"}),!1;plus.gallery.pick(function(e){e.files.map(function(e){t.updated(e,1).then(function(e){t.$vux.loading.hide();var a=e.Data[0];a.FileSize=e.FileSize,a.src=api50+"/api/v1/File/DownLoadPic?filePath="+a.FilePath,t.imgFile.push(a)}).catch(function(e){t.$vux.loading.hide();var a=e.ErrorMessage||"上传失败";t.$vux.toast.text(a)})})},function(){},{filter:"image",multiple:!0,maximum:5-this.imgFile.length,system:!1})}),o()(e,"updated",function(t,e){var a=this;return new r.a(function(s,o){var i=a.BillFileUrl(e),r=plus.uploader.createUpload(i,{method:"POST",blocksize:10485760},function(t){var e=JSON.parse(t.responseText);1==e.State?(e.FileSize=t.totalSize,s(e)):o(e)}),n=t.substr(t.lastIndexOf("/")+1,t.length-t.lastIndexOf("/"));r.addFile(t,{key:n});var u=0;r.addEventListener("statechanged",function(t,s){if(2!=e&&t.totalSize>10485760)return a.$vux.toast.show({type:"warn",text:"图片大小不超过10M"}),r.abort(),!1;0==u&&a.$vux.loading.show({text:"上传中"}),u++},!1),r.start()})}),o()(e,"saveImg",function(t){}),o()(e,"delPic",function(t){var e=this;this.$vux.confirm.show({content:"确定删除该图片吗？",onConfirm:function(){e.imgFile.splice(t,1)}})}),o()(e,"imgShow",function(t){this.$refs.previewer.show(t)}),o()(e,"delProduct",function(t){this.chooseProductData.splice(t,1)}),o()(e,"getLinkman",function(){var t=this;return new r.a(function(e){t.getAxios("/Customer/GetPagedCustomerLinkManList",{page:1,count:100,customerId:t.CustomerID}).then(function(a){t.cLinkman=[];var s=[];a.Data.List.forEach(function(t){s.push({value:""+t.ID,name:t.LinkName})}),t.cLinkman.push(s),t.LinkUser=[""+t.LinkUserID],e()})})}),e))}).call(e,a("mtWM"))},en8I:function(t,e){},hZR2:function(t,e,a){"use strict";(function(t){var s,o=a("bOdI"),i=a.n(o),r=a("//Fk"),n=a.n(r),u=a("Dd8w"),c=a.n(u),l=a("ABCa"),h=a("rHil"),m=a("pDNl"),f=a("1DHf"),d=a("pTXB"),v=a("UNGY"),p=a("7Ah8"),D=a("ALGc"),w=a("2sLL"),C=a("2FOq"),x=a("NYxO"),k=a("yZFb"),g=a("BPFO"),y=a("lzuW"),S=a("oqQY"),P=a.n(S);e.a={name:"NewOrder",mixins:[y.a],components:{UserSelect:g.a,XHeader:l.a,Group:h.a,XInput:m.a,Cell:f.a,FormPreview:d.a,Datetime:v.a,Dict:k.a,PopupPicker:p.a,XTextarea:D.a,XButton:w.a,Previewer:C.a},props:{workRu:{type:Boolean,default:!0},width:{default:85}},data:function(){return{options:{saveImg:function(t){}},orderno:"自动生成",payment:[["未付","支票","网上银行","电付","邮局汇款","支付宝","其他"]],payMethod:["未付"],form:{Title:"",BeginDate:P()(new Date).format("YYYY-MM-DD"),EndDate:"",DealDate:P()(new Date).format("YYYY-MM-DD"),PayType:"",OrderState:[],Remark:"",TotalPrice:0,CustState:[],CustStateName:""},productList:[],defaultChoose:[],imgFile:[],CustomerID:"",CustomerName:"请选择客户",LinkUserID:[],cLinkman:[],LinkUser:[],isUserShow:!1,areyouok:!0,isSelectCust:!0,parentPath:"",userShow:!1,checkVal:[],senders:[],sendersName:"",goBackAndClean:!0}},computed:c()({},Object(x.c)(["getChooseProductData","getChooseCustomer"]),Object(x.e)(["chooseProductData","chooseCustomer","chooseLinkMan"])),filters:{picUrl:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return api50+"/api/v1/File/DownLoadPic?filePath="+t+"&w="+e+"&h="+a}},mounted:function(){var t=this;this.$bus.on("selectedClient",function(e){t.CustomerID=e.ID,t.CustomerName=e.CustomerName,t.LinkUserID=e.LinkID,t.form.CustState[0]=e.CustState,t.form.CustStateName=e.CustStateName}),this.$route.query.cId?(this.CustomerID=this.$route.query.cId,this.isSelectCust=!1,this.getLinkman()):this.isSelectCust=!0,this.$route.query.cName&&(this.CustomerName=this.$route.query.cName),this.$route.query.cLink&&(this.LinkUserID=this.$route.query.cLink),this.$route.query.cCustStateName&&(this.form.CustState[0]=this.$route.query.cState,this.form.CustStateName=this.$route.query.cCustStateName),this.parentPath=this.$route.path},activated:function(){this.$route.query.cId?(this.CustomerID=this.$route.query.cId,this.isSelectCust=!1,this.getLinkman()):this.isSelectCust=!0,this.$route.query.cName&&(this.CustomerName=this.$route.query.cName),this.$route.query.cLink&&(this.LinkUserID=this.$route.query.cLink),this.$route.query.cCustStateName&&(this.form.CustState[0]=this.$route.query.cState,this.form.CustStateName=this.$route.query.cCustStateName),this.parentPath=this.$route.path},destroyed:function(){},beforeRouteLeave:function(t,e,a){if("/"!=t.fullPath&&-1==t.fullPath.indexOf("client")||!this.goBackAndClean)a();else{var s=this;this.$vux.confirm.show({title:"继续退出？",content:"您已编辑过，退出将丢失这些内容！",onCancel:function(){a(!1)},onConfirm:function(){s.form.Title="",s.setChooseProduct([]),s.form.EndDate="",s.$set(s.payMethod,0,s.payment[0][0]),s.form.CustState=[],s.form.Remark="",s.form.OrderState=[],s.form.TotalPrice=0,s.imgFile=[],s.CustomerName="请选择客户",s.CustomerID="",s.LinkUserID=[],s.cLinkman=[],s.LinkUser=[],s.form.CustStateName="",s.$refs.OrderState.cleanValue(),s.$refs.CustState.cleanValue(),s.sendersName="",s.senders=[],a()}})}},methods:c()({},Object(x.d)(["setChooseCustomer","setChooseLinkMan","setChooseProduct"]),(s={userSelected:function(t){var e=this;this.senders=[],this.sendersName="",t.forEach(function(a){e.senders.push({UserID:a.ID,IsDelete:0,ID:0}),t.length<2?e.sendersName+=a.OrgName:e.sendersName+=a.OrgName+","}),this.checkVal=t.map(function(t){return{UserID:t.ID,Name:t.OrgName}}),this.userShow=!1},formatTotalPrice:function(){this.form.TotalPrice=parseFloat((this.form.TotalPrice+"").replace(/[^\d.]/g,"")).toFixed(2)},changeDealNum:function(t,e,a){var s=this;this.$store.state.chooseProductData.forEach(function(a,o){e.ID==a.ID&&(s.$store.state.chooseProductData[o].DealNum=parseInt(t.target.value))})},getTotalPrice:function(){var t=0;this.productList.forEach(function(e){(""==e.DealNum||isNaN(e.DealNum))&&(e.DealNum=0),t+=e.DealPrice*parseInt(e.DealNum)}),this.form.TotalPrice=t.toFixed(2)},beforeShow:function(){if(!this.CustomerID)return this.$vux.toast.show({type:"warn",text:"请先选择客户"}),this.isUserShow=!1,!1;this.isUserShow=!0},saveOrder:function(){var e=this;this.form.TotalPrice=parseFloat((this.form.TotalPrice+"").replace(/[^\d.]/g,"")).toFixed(2);var a="";if(this.payment[0].some(function(t,s){if(t===e.payMethod[0])return a=s+1+"",!0}),this.areyouok){if(this.areyouok=!1,!this.CustomerID)return this.$vux.toast.show({type:"warn",text:"请选择客户"}),void(this.areyouok=!0);if(0===this.LinkUser.length)return this.$vux.toast.show({type:"warn",text:"请选择联系人"}),void(this.areyouok=!0);if(0==this.chooseProductData.length)return this.$vux.toast.show({type:"warn",text:"请选择产品"}),void(this.areyouok=!0);if(""==this.form.DealDate)return this.$vux.toast.show({type:"warn",text:"请选择签约时间"}),void(this.areyouok=!0);if(""==this.form.BeginDate)return this.$vux.toast.show({type:"warn",text:"请选择开始时间"}),void(this.areyouok=!0);if(""==this.form.EndDate)return this.$vux.toast.show({type:"warn",text:"请选择结束时间"}),void(this.areyouok=!0);if(P()(this.form.BeginDate).unix()>P()(this.form.EndDate).unix())return this.$vux.toast.show({type:"warn",text:"开始时间不能大于结束时间"}),void(this.areyouok=!0);if(""===this.form.OrderState||void 0==this.form.OrderState)return this.$vux.toast.show({type:"warn",text:"请选择订单状态"}),void(this.areyouok=!0);if(""===this.form.CustState||void 0==this.form.CustState)return this.$vux.toast.show({type:"warn",text:"请选择客户状态"}),void(this.areyouok=!0);var s=[],o=!0,i=!0;if(this.chooseProductData.forEach(function(t){(parseInt(t.DealNum)<=0||""==t.DealNum)&&(o=!1),parseInt(t.DealNum)>=1e7&&(i=!1),s.push({ID:0,OrderProdID:t.ID,DealNum:t.DealNum,DealPrice:t.DealPrice,Remark:t.Remark})}),!o)return this.$vux.toast.show({type:"warn",text:"产品数量必须大于0"}),void(this.areyouok=!0);if(!i)return this.$vux.toast.show({type:"warn",text:"产品数量必须小于10000000"}),void(this.areyouok=!0);if(parseFloat(this.form.TotalPrice)<=0)return this.$vux.toast.show({type:"warn",text:"成交总额必须大于0"}),void(this.areyouok=!0);if(parseFloat(this.form.TotalPrice)>=1e10)return this.$vux.toast.show({type:"warn",text:"成交总额必须小于10000000000"}),void(this.areyouok=!0);var r={ID:0,IsAutoNumber:1,CustomerState:this.form.CustState.ID,Title:this.form.Title,Remark:this.form.Remark,ClientID:this.CustomerID,CustomerID:this.CustomerID,LinkUserID:this.LinkUser[0],CustomerName:this.CustomerName,BeginDate:this.form.BeginDate+" 00:00:00",EndDate:this.form.EndDate+" 00:00:00",DealDate:this.form.DealDate+" 00:00:00",PayType:a,OrderNumber:"",TotalPrice:this.form.TotalPrice,OrderState:this.form.OrderState.ID,Prods:s,ImgAttach:this.imgFile,Senders:this.senders};t.post("/Order/SaveOrder",r).then(function(t){if(1===t.data.State){e.$vux.toast.show({text:"保存成功",type:"success"});var a=[];e.senders.forEach(function(t){a.push(t.UserID)}),a.length>0&&e.send(a,t.data.Data),e.goBackAndClean=!1,e.$bus.emit("onSave",!0),e.$bus.emit("refreshOrderList"),setTimeout(function(){e.form.Title="",e.setChooseProduct([]),e.form.DealDate="",e.form.BeginDate="",e.form.EndDate="",e.payMethod[0]=e.payment[0][0],e.form.CustState=[],e.form.Remark="",e.form.OrderState=[],e.form.TotalPrice=0,e.imgFile=[],e.CustomerName="请选择客户",e.CustomerID="",e.LinkUserID=[],e.cLinkman=[],e.LinkUser=[],e.form.CustStateName="",e.$refs.OrderState.cleanValue(),e.$refs.CustState.cleanValue(),e.$router.back(),e.areyouok=!0,e.$vux.toast.hide()},500)}else e.areyouok=!0,e.$vux.toast.show({text:t.data.ErrorMessage,type:"warn"})}).catch(function(t){e.$vux.toast.show({text:"网络异常",type:"warn"})})}},send:function(t,e){var a=this;t.forEach(function(e,s){e==a.$store.state.CurrentUserID&&t.splice(s,1)});var s={SendUsers:t,EvName:"crm-order",ImgPath:down+"/mdtcrm/CRMOrder.jpg",Title:"订单",Content:"您有一个新的订单",Params:[e]};this.postAxios(api50+"/api/v1/Common/SendSingleEventMsg",s).then(function(t){console.log(t)})}},i()(s,"send",function(t,e){var a=this;t.forEach(function(e,s){e==a.$store.state.CurrentUserID&&t.splice(s,1)});var s={SendUsers:t,EvName:"crm-order",ImgPath:down+"/mdtcrm/CRMOrder.jpg",Title:"订单",Content:"您有一个新的订单",Params:[e]};this.postAxios(api50+"/api/v1/Common/SendSingleEventMsg",s).then(function(t){console.log(t)})}),i()(s,"showUser",function(){this.chooseCustomer.ID&&this.$router.push("/selectLinkman?id="+this.chooseCustomer.ID)}),i()(s,"selectPic",function(){var t=this;if(this.imgFile.length>=5)return this.$vux.toast.show({type:"warn",text:"最多上传五张"}),!1;plus.gallery.pick(function(e){e.files.map(function(e){t.updated(e,1).then(function(e){t.$vux.loading.hide();var a=e.Data[0];a.FileSize=e.FileSize,a.src=api50+"/api/v1/File/DownLoadPic?filePath="+a.FilePath,t.imgFile.push(a)}).catch(function(e){t.$vux.loading.hide();var a=e.ErrorMessage||"上传失败";t.$vux.toast.text(a)})})},function(){},{filter:"image",multiple:!0,maximum:5-this.imgFile.length,system:!1})}),i()(s,"updated",function(t,e){var a=this;return new n.a(function(s,o){var i=a.BillFileUrl(e),r=plus.uploader.createUpload(i,{method:"POST",blocksize:10485760},function(t){var e=JSON.parse(t.responseText);1==e.State?(e.FileSize=t.totalSize,s(e)):o(e)}),n=t.substr(t.lastIndexOf("/")+1,t.length-t.lastIndexOf("/"));r.addFile(t,{key:n});var u=0;r.addEventListener("statechanged",function(t,s){if(2!=e&&t.totalSize>10485760)return a.$vux.toast.show({type:"warn",text:"图片大小不超过10M"}),r.abort(),!1;0==u&&a.$vux.loading.show({text:"上传中"}),u++},!1),r.start()})}),i()(s,"saveImg",function(t){}),i()(s,"delPic",function(t){var e=this;this.$vux.confirm.show({content:"确定删除该图片吗？",onConfirm:function(){e.imgFile.splice(t,1)}})}),i()(s,"imgShow",function(t){this.$refs.previewer.show(t)}),i()(s,"delProduct",function(t){this.chooseProductData.splice(t,1)}),i()(s,"getLinkman",function(){var t=this;return new n.a(function(e){t.getAxios("/Customer/GetPagedCustomerLinkManList",{page:1,count:100,customerId:t.CustomerID}).then(function(a){t.cLinkman=[];var s=[];a.Data.List.forEach(function(t){s.push({value:""+t.ID,name:t.LinkName})}),t.cLinkman.push(s),t.LinkUser=[""+t.LinkUserID],e()})})}),s)),watch:{chooseProductData:{deep:!0,handler:function(t){var e=this;this.defaultChoose=[],0!==t.length&&(t.forEach(function(t){e.defaultChoose.push(t.ID),parseInt(t.DealNum)<=0&&(t.DealNum=1),t.DealNum=parseInt(t.DealNum)}),this.productList=t,this.setChooseProduct(t),this.getTotalPrice())}},productList:{handler:function(t){this.getTotalPrice()},deep:!0},CustomerID:function(){this.CustomerID&&this.getLinkman()},"form.TotalPrice":function(t){}}}}).call(e,a("mtWM"))},pTXB:function(t,e,a){"use strict";var s=a("0FxO"),o={name:"form-preview",props:["headerLabel","headerValue","bodyItems","footerButtons","name"],methods:{onButtonClick:function(t,e){t&&t(this.name),e&&Object(s.a)(e,this.$router)}}},i={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"vux-form-preview weui-form-preview"},[a("div",{staticClass:"weui-form-preview__hd"},[a("label",{staticClass:"weui-form-preview__label",domProps:{innerHTML:t._s(t.headerLabel)}}),t._v(" "),a("em",{staticClass:"weui-form-preview__value",domProps:{innerHTML:t._s(t.headerValue||"&nbsp;")}})]),t._v(" "),a("div",{staticClass:"weui-form-preview__bd"},t._l(t.bodyItems,function(e){return a("div",{staticClass:"weui-form-preview__item"},[a("label",{staticClass:"weui-form-preview__label"},[t._v(t._s(e.label))]),t._v(" "),a("span",{staticClass:"weui-form-preview__value"},[t._v(t._s(e.value))])])})),t._v(" "),a("div",{staticClass:"weui-form-preview__ft"},t._l(t.footerButtons,function(e){return a("a",{staticClass:"weui-form-preview__btn",class:{"weui-form-preview__btn_default":"default"===e.style,"weui-form-preview__btn_primary":"primary"===e.style},attrs:{href:"javascript:"},on:{click:function(a){t.onButtonClick(e.onButtonClick,e.link)}}},[t._v(t._s(e.text))])}))])},staticRenderFns:[]};var r=a("VU/8")(o,i,!1,function(t){a("HAL1")},null,null);e.a=r.exports},yZFb:function(t,e,a){"use strict";a("AcdC");var s=a("FL0N"),o={render:function(){var t=this,e=t.$createElement;return(t._self._c||e)("popup-picker",{attrs:{title:t.title,data:t.list},on:{"on-show":t.onShow,"on-hide":t.onHide,"on-change":t.onChange},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}})},staticRenderFns:[]};var i=function(t){a("1XKH")},r=a("VU/8")(s.a,o,!1,i,"data-v-76f191d1",null);e.a=r.exports}});
//# sourceMappingURL=8.7e10672fb9406fce7f94.js.map