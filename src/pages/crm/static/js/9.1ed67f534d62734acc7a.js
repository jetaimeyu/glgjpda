webpackJsonp([9],{"1XKH":function(t,e){},AcdC:function(t,e,a){"use strict";(function(t){a("7Ah8").a}).call(e,a("mtWM"))},ArIH:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});a("tsXL");var s=a("MMlx"),o={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"new-order"},[a("x-header",{attrs:{"left-options":{preventGoBack:!0}},on:{"on-click-back":t.pageBack}},[t._v("修改订单\n  ")]),t._v(" "),a("div",{ref:"content",staticClass:"content"},[a("Group",[a("XInput",{attrs:{title:"订单编号",value:t.form.orderNumber,disabled:""}}),t._v(" "),a("XInput",{attrs:{title:"主题",max:50},model:{value:t.form.Title,callback:function(e){t.$set(t.form,"Title",e)},expression:"form.Title"}}),t._v(" "),a("cell",{attrs:{title:"客户",value:t.CustomerName,"is-link":""},nativeOn:{click:function(e){t.$router.push("changeOrder/selectCust")}}},[a("span",{staticStyle:{color:"red"},attrs:{slot:"icon"},slot:"icon"},[t._v("*")])]),t._v(" "),a("popup-picker",{attrs:{"show-name":!0,title:"联系人",placeholder:"请选择联系人",data:t.cLinkman,show:t.isUserShow},on:{"on-change":function(e){return t.LinkUserID=e[0]}},nativeOn:{click:function(e){return t.beforeShow(e)}},model:{value:t.LinkUser,callback:function(e){t.LinkUser=e},expression:"LinkUser"}},[a("div",{staticClass:"label",staticStyle:{width:"85px"},attrs:{slot:"title"},slot:"title"},[t._v("\n          联系人\n        ")])]),t._v(" "),a("user-select",{attrs:{show:t.userShow,title:"选择抄送人",defaultUser:t.checkVal},on:{save:t.userSelected,close:function(e){t.userShow=!1}}}),t._v(" "),a("cell",{staticClass:"max-width90",attrs:{title:"选择抄送人",value:t.sendersName,"is-link":""},nativeOn:{click:function(e){t.userShow=!0}}}),t._v(" "),a("cell",{attrs:{title:"选择成交产品",value:"","is-link":"",link:"changeOrder/chooseProduct"}},[a("span",{staticStyle:{color:"red"},attrs:{slot:"icon"},slot:"icon"},[t._v("*")])]),t._v(" "),a("div",{staticClass:"product-list"},t._l(t.getChooseProductData,function(e,s){return a("div",{staticClass:"product-list-item"},[a("svg",{staticClass:"vux-x-icon vux-x-icon-ios-minus close",attrs:{type:"ios-minus",size:"25",xmlns:"http://www.w3.org/2000/svg",width:"25",height:"25",viewBox:"0 0 512 512"},on:{click:function(e){e.stopPropagation(),t.delProduct(s)}}},[a("path",{attrs:{d:"M256 48C141.1 48 48 141.1 48 256s93.1 208 208 208 208-93.1 208-208S370.9 48 256 48zm128 217H128v-17h256v17z"}})]),t._v(" "),a("x-input",{attrs:{title:"产品名称:",value:e.ProdName,disabled:""}}),t._v(" "),a("x-input",{attrs:{title:"销售单价",value:e.DealPrice,disabled:""}}),t._v(" "),a("div",{staticClass:"dealnum"},[a("span",[t._v("销售数量")]),t._v(" "),a("input",{attrs:{type:"number",max:"1000000"},domProps:{value:e.DealNum},on:{blur:function(a){t.changeDealNum(a,e,s)}}})]),t._v(" "),a("x-input",{attrs:{title:"备注"},model:{value:e.Remark,callback:function(a){t.$set(e,"Remark",a)},expression:"item.Remark"}})],1)})),t._v(" "),a("Datetime",{attrs:{format:"YYYY-MM-DD",title:"成交/签约时间"},model:{value:t.form.DealDate,callback:function(e){t.$set(t.form,"DealDate",e)},expression:"form.DealDate"}},[a("p",{attrs:{slot:"title"},slot:"title"},[a("span",{staticStyle:{color:"red"},attrs:{slot:"icon"},slot:"icon"},[t._v("*")]),t._v("\n          成交/签约时间")])]),t._v(" "),a("Datetime",{attrs:{format:"YYYY-MM-DD",title:"有效期开始时间"},model:{value:t.form.BeginDate,callback:function(e){t.$set(t.form,"BeginDate",e)},expression:"form.BeginDate"}},[a("p",{attrs:{slot:"title"},slot:"title"},[a("span",{staticStyle:{color:"red"},attrs:{slot:"icon"},slot:"icon"},[t._v("*")]),t._v("\n          有效期开始时间")])]),t._v(" "),a("Datetime",{attrs:{format:"YYYY-MM-DD",title:"有效期结束时间"},model:{value:t.form.EndDate,callback:function(e){t.$set(t.form,"EndDate",e)},expression:"form.EndDate"}},[a("p",{attrs:{slot:"title"},slot:"title"},[a("span",{staticStyle:{color:"red"},attrs:{slot:"icon"},slot:"icon"},[t._v("*")]),t._v("\n          有效期结束时间")])]),t._v(" "),a("popup-picker",{attrs:{title:"选择付款方式",data:t.payment,"popup-title":"选择付款方式"},model:{value:t.payMethod,callback:function(e){t.payMethod=e},expression:"payMethod"}}),t._v(" "),a("dict",{attrs:{title:"选择订单状态",type:"20",data:t.form.OrderState,defaultValue:t.OrderStateName},on:{"update:data":function(e){t.$set(t.form,"OrderState",e)}}}),t._v(" "),a("x-textarea",{attrs:{max:200,title:"说明"},model:{value:t.form.Remark,callback:function(e){t.$set(t.form,"Remark",e)},expression:"form.Remark"}}),t._v(" "),a("dict",{attrs:{title:"更新客户状态",type:"5",data:t.form.CustState,defaultValue:t.CustomerStateName},on:{"update:data":function(e){t.$set(t.form,"CustState",e)}}}),t._v(" "),a("cell",{attrs:{title:"上传图片","is-link":""},nativeOn:{click:function(e){return t.selectPic(e)}}},[a("i",{staticClass:"flex-1 iconfont icon-zhaopian"})])],1),t._v(" "),a("div",{staticClass:"updatePic flex"},t._l(t.imgFile,function(e,s){return a("div",{key:s,staticClass:"picBoxWrap"},[a("div",{staticClass:"picBox"},[a("img",{attrs:{src:t._f("picUrl")(e.FilePath)},on:{click:function(e){t.imgShowPic(s)}}})]),t._v(" "),a("svg",{staticClass:"vux-x-icon vux-x-icon-ios-minus close",attrs:{type:"ios-minus",size:"25",xmlns:"http://www.w3.org/2000/svg",width:"25",height:"25",viewBox:"0 0 512 512"},on:{click:function(e){t.delPic(s)}}},[a("path",{attrs:{d:"M256 48C141.1 48 48 141.1 48 256s93.1 208 208 208 208-93.1 208-208S370.9 48 256 48zm128 217H128v-17h256v17z"}})])])})),t._v(" "),a("previewer",{ref:"previewer",attrs:{list:t.imgFile,options:t.options},on:{"on-close":t.closePic},scopedSlots:t._u([{key:"button-after",fn:function(e){return[a("i",{staticClass:"iconfont icon-iconset0237",staticStyle:{"font-size":"20px",color:"#BFBFBF","line-height":"44px","margin-left":"10px"},on:{click:function(e){e.preventDefault(),e.stopPropagation(),t.saveImg()}}})]}}])}),t._v(" "),a("div",{staticClass:"footer"},[a("span",[t._v("订单总额:")]),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.form.TotalPrice,expression:"form.TotalPrice"}],domProps:{value:t.form.TotalPrice},on:{blur:t.formatTotalPrice,input:function(e){e.target.composing||t.$set(t.form,"TotalPrice",e.target.value)}}}),t._v(" "),a("button",{on:{click:t.saveOrder}},[t._v("确认保存")])])],1),t._v(" "),a("router-view")],1)},staticRenderFns:[]};var r=function(t){a("hZzh")},i=a("VU/8")(s.a,o,!1,r,"data-v-5d24edbc",null);e.default=i.exports},FL0N:function(t,e,a){"use strict";(function(t){var s=a("7Ah8");e.a={name:"Dict",components:{PopupPicker:s.a},props:{title:{default:"选择器"},type:{default:"4"},dictId:{default:0},defaultValue:{default:""},data:{default:function(){return{}}}},data:function(){return{value:[""],dict:{},list:[[""]],allList:[]}},mounted:function(){this.initData()},activated:function(){this.initData()},watch:{defaultValue:function(t){this.$set(this.value,0,t)}},methods:{initData:function(){var e=this;t.get("/Common/GetPagedPubDictionaryList?dicType="+this.type+"&page=1&count=100").then(function(t){if(1===t.data.State){e.list[0]=[],22==e.type&&t.data.Data.List.forEach(function(e){0==e.CompID&&t.data.Data.List.splice(e,1)}),e.allList=t.data.Data.List;var a=[];t.data.Data.List.forEach(function(t){a.push(t.DictName)}),e.$set(e.list,0,a),""!=e.defaultValue?e.$set(e.value,0,e.defaultValue):e.$set(e.value,0,t.data.Data.List[0].DictName),e.allList.some(function(t){if(t.DictName===e.value[0])return e.$emit("update:data",t),!0})}}).catch(function(t){console.log(t),e.$vux.toast.show({text:"网络异常",type:"warn"})})},cleanValue:function(){this.$set(this.value,0,this.allList[0].DictName)},onShow:function(){},onHide:function(){var t=this;this.allList.some(function(e){if(e.DictName===t.value[0])return t.$emit("update:data",e),!0})},onChange:function(t){},getDict:function(){return this.dict}}}}).call(e,a("mtWM"))},HAL1:function(t,e){},MMlx:function(t,e,a){"use strict";(function(t){var s=a("//Fk"),o=a.n(s),r=a("woOf"),i=a.n(r),n=a("Dd8w"),c=a.n(n),l=a("ABCa"),u=a("rHil"),h=a("pDNl"),m=a("1DHf"),f=a("pTXB"),d=a("UNGY"),D=a("7Ah8"),p=a("ALGc"),v=a("2sLL"),I=a("2FOq"),g=a("NYxO"),w=a("yZFb"),C=a("BPFO"),x=a("lzuW");e.a={name:"ChangeOrder",mixins:[x.a],components:{UserSelect:C.a,XHeader:l.a,Group:u.a,XInput:h.a,Cell:m.a,FormPreview:f.a,Datetime:d.a,Dict:w.a,PopupPicker:D.a,XTextarea:p.a,XButton:v.a,Previewer:I.a},props:{workRu:{type:Boolean,default:!0},width:{default:85}},data:function(){return{options:{saveImg:function(t){}},orderno:"自动生成",payment:[["未付","支票","网上银行","电付","邮局汇款","支付宝","其他"]],payMethod:[],form:{Title:"",BeginDate:"",EndDate:"",DealDate:"",PayType:"",OrderState:[],Remark:"",TotalPrice:0,CustState:"",orderNumber:""},productList:[],defaultChoose:[],imgFile:[],CustomerID:"",CustomerName:"请选择客户",OrderStateName:"",CustomerStateName:"",LinkUserID:[],cLinkman:[],LinkUser:[],isUserShow:!1,ID:"",allData:[],parentPath:"",firstEnter:!0,userShow:!1,checkVal:[],oldCheckVal:[],senders:[],sendersName:"",url:""}},computed:c()({},Object(g.c)(["getChooseProductData","getChooseCustomer"]),Object(g.e)(["chooseProductData","chooseCustomer","chooseLinkMan"])),filters:{picUrl:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return api50+"/api/v1/File/DownLoadPic?filePath="+t+"&w="+e+"&h="+a}},mounted:function(){var t=this;this.$bus.on("selectedClient",function(e){console.log(1),t.CustomerID=e.ID,t.CustomerName=e.CustomerName,t.LinkUserID=e.LinkID}),this.$route.query.url,this.ID=this.$route.query.id,this.GetOrderInfoByID(),this.$refs.content.style.height=document.body.clientHeight-98+"px",this.parentPath=this.$route.path},activated:function(){var t=this;this.$bus.on("selectedClient",function(e){t.CustomerID=e.ID,t.CustomerName=e.CustomerName,t.LinkUserID=e.LinkID}),this.ID=this.$route.query.id,this.GetOrderInfoByID()},destroyed:function(){this.$bus.off("selectedClient")},methods:c()({},Object(g.d)(["setChooseCustomer","setChooseLinkMan","setChooseProduct"]),{userSelected:function(t){var e=this;this.senders=[],this.sendersName="",t.forEach(function(t){e.senders.push({UserID:t.ID,IsDelete:0,ID:0}),e.sendersName+=t.OrgName}),console.log(this.senders),this.checkVal=t.map(function(t){return{UserID:t.ID,Name:t.OrgName}}),this.userShow=!1},changeDealNum:function(t,e,a){var s=this;this.$store.state.chooseProductData.forEach(function(a,o){e.ID==a.ID&&(s.$store.state.chooseProductData[o].DealNum=parseInt(t.target.value))})},pageBack:function(){this.setChooseProduct([]),this.$router.back()},formatTotalPrice:function(){this.form.TotalPrice=parseFloat((this.form.TotalPrice+"").replace(/[^\d.]/g,"")).toFixed(2)},getTotalPrice:function(){var t=0;this.chooseProductData.forEach(function(e){t+=e.DealPrice*parseInt(e.DealNum)}),this.firstEnter?(this.form.TotalPrice=this.allData.TotalPrice,this.firstEnter=!1):this.form.TotalPrice=t.toFixed(2)},beforeShow:function(){if(!this.CustomerID)return this.$vux.toast.show({type:"warn",text:"请先选择客户"}),this.isUserShow=!1,!1;this.isUserShow=!0},saveOrder:function(){var e=this;this.form.TotalPrice=parseFloat((this.form.TotalPrice+"").replace(/[^\d.]/g,"")).toFixed(2);var a="";if(this.payment[0].some(function(t,s){if(t===e.payMethod[0])return a=s+1+"",!0}),this.form.TotalPrice=parseFloat(this.form.TotalPrice).toFixed(2),this.CustomerID)if(0!==this.LinkUser.length)if(0!=this.chooseProductData.length)if(""!=this.form.DealDate)if(""!=this.form.BeginDate)if(""!=this.form.EndDate)if(""!==this.form.OrderState&&void 0!=this.form.OrderState)if(""!==this.form.CustState&&void 0!=this.form.CustState){var s=[],o=!0,r=!0;if(this.chooseProductData.forEach(function(t){var a={};(parseInt(t.DealNum)<=0||""==t.DealNum)&&(o=!1),parseInt(t.DealNum)>=1e7&&(r=!1),e.allData.Prods.some(function(e){if(t.ID===e.ID)return i()(a,t,{OrderProdID:e.ID,ID:e.cID}),!0;i()(a,t,{OrderProdID:t.ID,ID:0})}),s.push(a)}),this.allData.Prods.forEach(function(t){var e=!1;s.forEach(function(a){t.cID==a.ID&&(e=!0)}),e||s.push(i()(t,{ID:t.cID,IsDelete:1}))}),o)if(r)if(parseFloat(this.form.TotalPrice)<=0)this.$vux.toast.show({type:"warn",text:"成交总额必须大于0"});else if(parseFloat(this.form.TotalPrice)>=1e10)this.$vux.toast.show({type:"warn",text:"成交总额必须小于10000000000"});else{this.senders.forEach(function(t,a){var s=!0,o="";e.oldCheckVal.some(function(e){t.UserID==e.UserID&&(s=!1,o=e.ID)}),e.senders[a].ID=s?0:o}),this.oldCheckVal.forEach(function(t,a){var s=!0;e.senders.some(function(e,a){if(t.ID==e.ID)return s=!1,!0}),s&&e.senders.push({ID:t.ID,isDelete:1,UserID:t.UserID})});var n={ID:this.ID,IsAutoNumber:1,CustomerState:this.form.CustState.ID,Title:this.form.Title,Remark:this.form.Remark,ClientID:this.CustomerID,CustomerID:this.CustomerID,LinkUserID:this.LinkUser[0],CustomerName:this.CustomerName,BeginDate:this.form.BeginDate+" 00:00:00",EndDate:this.form.EndDate+" 00:00:00",DealDate:this.form.DealDate+" 00:00:00",PayType:a,OrderNumber:this.form.orderNumber,TotalPrice:this.form.TotalPrice,OrderState:this.form.OrderState.ID,Prods:s,ImgAttach:this.imgFile,Senders:this.senders};t.post("/Order/SaveOrder",n).then(function(t){if(1===t.data.State){e.$vux.toast.show({text:"保存成功",type:"success"});var a=[];e.senders.forEach(function(t){a.push(t.UserID)}),a.length>0&&e.send(a,t.data.Data),e.$bus.emit("onSave",!0),e.$bus.emit("refreshOrderList"),setTimeout(function(){e.form.Title="",e.setChooseProduct([]),e.form.DealDate="",e.form.BeginDate="",e.form.EndDate="",e.payMethod=[],e.form.CustState=[],e.form.Remark="",e.form.OrderState=[],e.form.TotalPrice=0,e.imgFile=[],e.CustomerName="请选择客户",e.CustomerID="",e.LinkUserID="",e.cLinkman=[],e.LinkUser=[],e.$bus.emit("refreshOrderList"),e.$router.back()},500)}}).catch(function(t){})}else this.$vux.toast.show({type:"warn",text:"产品数量必须小于10000000"});else this.$vux.toast.show({type:"warn",text:"产品数量必须大于0"})}else this.$vux.toast.show({type:"warn",text:"请选择客户状态"});else this.$vux.toast.show({type:"warn",text:"请选择订单状态"});else this.$vux.toast.show({type:"warn",text:"请选择结束时间"});else this.$vux.toast.show({type:"warn",text:"请选择开始时间"});else this.$vux.toast.show({type:"warn",text:"请选择签约时间"});else this.$vux.toast.show({type:"warn",text:"请选择产品"});else this.$vux.toast.show({type:"warn",text:"请选择联系人"});else this.$vux.toast.show({type:"warn",text:"请选择客户"})},showUser:function(){this.chooseCustomer.ID&&this.$router.push("/selectLinkman?id="+this.chooseCustomer.ID)},selectPic:function(){var t=this;if(this.imgFile.length>=5)return this.$vux.toast.show({type:"warn",text:"最多上传五张"}),!1;plus.gallery.pick(function(e){e.files.map(function(e){t.updated(e,1).then(function(e){t.$vux.loading.hide();var a=e.Data[0];a.FileSize=e.FileSize,a.src=api50+"/api/v1/File/DownLoadPic?filePath="+a.FilePath,t.imgFile.push(a)}).catch(function(e){t.$vux.loading.hide();var a=e.ErrorMessage||"上传失败";t.$vux.toast.text(a)})})},function(){},{filter:"image",multiple:!0,maximum:5-this.imgFile.length,system:!1})},updated:function(t,e){var a=this;return new o.a(function(s,o){var r=a.BillFileUrl(e),i=plus.uploader.createUpload(r,{method:"POST",blocksize:10485760},function(t){var e=JSON.parse(t.responseText);1==e.State?(e.FileSize=t.totalSize,s(e)):o(e)}),n=t.substr(t.lastIndexOf("/")+1,t.length-t.lastIndexOf("/"));i.addFile(t,{key:n});var c=0;i.addEventListener("statechanged",function(t,s){if(2!=e&&t.totalSize>10485760)return a.$vux.toast.show({type:"warn",text:"图片大小不超过10M"}),i.abort(),!1;0==c&&a.$vux.loading.show({text:"上传中"}),c++},!1),i.start()})},saveImg:function(t){},delPic:function(t){var e=this;this.$vux.confirm.show({content:"确定删除该图片吗？",onConfirm:function(){e.imgFile.splice(t,1)}})},imgShow:function(t){this.$refs.previewer.show(t)},delProduct:function(t){var e=this.chooseProductData;e.splice(t,1),this.setChooseProduct(e)},getLinkman:function(){var t=this;return new o.a(function(e){t.getAxios("/Customer/GetPagedCustomerLinkManList",{page:1,count:100,customerId:t.CustomerID}).then(function(a){t.cLinkman=[];var s=[];a.Data.List.forEach(function(t){s.push({value:""+t.ID,name:t.LinkName})}),t.cLinkman.push(s),t.LinkUser=[""+t.LinkUserID],e()})})},send:function(t,e){var a=this;t.forEach(function(e,s){e==a.$store.state.CurrentUserID&&t.splice(s,1)});var s={SendUsers:t,EvName:"crm-order",ImgPath:down+"/mdtcrm/CRMOrder.jpg",Title:"订单",Content:"您有一个新的订单",Params:[e]};this.postAxios(api50+"/api/v1/Common/SendSingleEventMsg",s).then(function(t){console.log(t)})},GetOrderInfoByID:function(){var e=this;t.get("/Order/GetOrderInfoByID/"+this.ID).then(function(t){if(1===t.data.State){console.log(t.data);var a=t.data.Data;e.allData=t.data.Data,e.form.Title=a.Title,e.form.orderNumber=a.OrderNumber,e.CustomerName=a.CustomerName,e.$set(e.LinkUser,0,a.LinkUserID+"");var s=[];a.Prods.forEach(function(t){s.push(i()(t,{cID:t.ID,ID:t.OrderProdID}))}),e.setChooseProduct(s),e.CustomerID=a.CustomerID,e.form.DealDate=a.DealDate.replace("00:00:00",""),e.form.BeginDate=a.BeginDate.replace("00:00:00",""),e.form.EndDate=a.EndDate.replace("00:00:00",""),e.$set(e.payMethod,0,e.payment[0][parseInt(a.PayType)-1]),e.OrderStateName=a.OrderStateName,e.form.Remark=a.Remark,e.CustomerStateName=a.CustomerStateName,e.form.CustState={ID:a.CustomerState,DictName:a.CustomerStateName},e.form.OrderState={ID:a.OrderState,DictName:a.OrderStateName},e.ID=a.ID,e.$nextTick(function(){e.form.TotalPrice=t.data.Data.TotalPrice}),e.imgFile=[];for(var o=0;o<t.data.Data.ImgAttach.length;o++){var r=t.data.Data.ImgAttach[o];/.*(gif|png|jpe?g)$/.test(r.FilePath)&&e.imgFile.push(i()(r,{src:api50+"/api/v1/File/DownLoadPic?filePath="+r.FilePath}))}e.sendersName="",t.data.Data.Senders.forEach(function(a){e.senders.push({UserID:a.UserID,IsDelete:0,ID:a.ID}),t.data.Data.Senders.length<2?e.sendersName+=a.Name:e.sendersName+=a.Name+","}),e.checkVal=t.data.Data.Senders,e.oldCheckVal=t.data.Data.Senders}}).catch(function(t){console.log(t)})}}),watch:{chooseProductData:{deep:!0,handler:function(t){var e=this;this.defaultChoose=[],0!==t.length&&(t.forEach(function(t){e.defaultChoose.push(t.ID),parseInt(t.DealNum)<=0&&(t.DealNum=1),t.DealNum=parseInt(t.DealNum)}),this.productList=t,this.setChooseProduct(t)),this.getTotalPrice()}},productList:{handler:function(t){},deep:!0},CustomerID:function(){this.CustomerID&&this.getLinkman()},"form.TotalPrice":function(t){}}}}).call(e,a("mtWM"))},hZzh:function(t,e){},pTXB:function(t,e,a){"use strict";var s=a("0FxO"),o={name:"form-preview",props:["headerLabel","headerValue","bodyItems","footerButtons","name"],methods:{onButtonClick:function(t,e){t&&t(this.name),e&&Object(s.a)(e,this.$router)}}},r={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"vux-form-preview weui-form-preview"},[a("div",{staticClass:"weui-form-preview__hd"},[a("label",{staticClass:"weui-form-preview__label",domProps:{innerHTML:t._s(t.headerLabel)}}),t._v(" "),a("em",{staticClass:"weui-form-preview__value",domProps:{innerHTML:t._s(t.headerValue||"&nbsp;")}})]),t._v(" "),a("div",{staticClass:"weui-form-preview__bd"},t._l(t.bodyItems,function(e){return a("div",{staticClass:"weui-form-preview__item"},[a("label",{staticClass:"weui-form-preview__label"},[t._v(t._s(e.label))]),t._v(" "),a("span",{staticClass:"weui-form-preview__value"},[t._v(t._s(e.value))])])})),t._v(" "),a("div",{staticClass:"weui-form-preview__ft"},t._l(t.footerButtons,function(e){return a("a",{staticClass:"weui-form-preview__btn",class:{"weui-form-preview__btn_default":"default"===e.style,"weui-form-preview__btn_primary":"primary"===e.style},attrs:{href:"javascript:"},on:{click:function(a){t.onButtonClick(e.onButtonClick,e.link)}}},[t._v(t._s(e.text))])}))])},staticRenderFns:[]};var i=a("VU/8")(o,r,!1,function(t){a("HAL1")},null,null);e.a=i.exports},tsXL:function(t,e,a){"use strict";(function(t){var e=a("//Fk"),s=a.n(e),o=a("woOf"),r=a.n(o),i=a("Dd8w"),n=a.n(i),c=a("ABCa"),l=a("rHil"),u=a("pDNl"),h=a("1DHf"),m=a("pTXB"),f=a("UNGY"),d=a("7Ah8"),D=a("ALGc"),p=a("2sLL"),v=a("2FOq"),I=a("NYxO"),g=a("yZFb"),w=a("BPFO");a("lzuW").a,w.a,c.a,l.a,u.a,h.a,m.a,f.a,g.a,d.a,D.a,p.a,v.a,Boolean,n()({},Object(I.c)(["getChooseProductData","getChooseCustomer"]),Object(I.e)(["chooseProductData","chooseCustomer","chooseLinkMan"])),n()({},Object(I.d)(["setChooseCustomer","setChooseLinkMan","setChooseProduct"]),{userSelected:function(t){var e=this;this.senders=[],this.sendersName="",t.forEach(function(t){e.senders.push({UserID:t.ID,IsDelete:0,ID:0}),e.sendersName+=t.OrgName}),console.log(this.senders),this.checkVal=t.map(function(t){return{UserID:t.ID,Name:t.OrgName}}),this.userShow=!1},changeDealNum:function(t,e,a){var s=this;this.$store.state.chooseProductData.forEach(function(a,o){e.ID==a.ID&&(s.$store.state.chooseProductData[o].DealNum=parseInt(t.target.value))})},pageBack:function(){this.setChooseProduct([]),this.$router.back()},formatTotalPrice:function(){this.form.TotalPrice=parseFloat((this.form.TotalPrice+"").replace(/[^\d.]/g,"")).toFixed(2)},getTotalPrice:function(){var t=0;this.chooseProductData.forEach(function(e){t+=e.DealPrice*parseInt(e.DealNum)}),this.firstEnter?(this.form.TotalPrice=this.allData.TotalPrice,this.firstEnter=!1):this.form.TotalPrice=t.toFixed(2)},beforeShow:function(){if(!this.CustomerID)return this.$vux.toast.show({type:"warn",text:"请先选择客户"}),this.isUserShow=!1,!1;this.isUserShow=!0},saveOrder:function(){var e=this;this.form.TotalPrice=parseFloat((this.form.TotalPrice+"").replace(/[^\d.]/g,"")).toFixed(2);var a="";if(this.payment[0].some(function(t,s){if(t===e.payMethod[0])return a=s+1+"",!0}),this.form.TotalPrice=parseFloat(this.form.TotalPrice).toFixed(2),this.CustomerID)if(0!==this.LinkUser.length)if(0!=this.chooseProductData.length)if(""!=this.form.DealDate)if(""!=this.form.BeginDate)if(""!=this.form.EndDate)if(""!==this.form.OrderState&&void 0!=this.form.OrderState)if(""!==this.form.CustState&&void 0!=this.form.CustState){var s=[],o=!0,i=!0;if(this.chooseProductData.forEach(function(t){var a={};(parseInt(t.DealNum)<=0||""==t.DealNum)&&(o=!1),parseInt(t.DealNum)>=1e7&&(i=!1),e.allData.Prods.some(function(e){if(t.ID===e.ID)return r()(a,t,{OrderProdID:e.ID,ID:e.cID}),!0;r()(a,t,{OrderProdID:t.ID,ID:0})}),s.push(a)}),this.allData.Prods.forEach(function(t){var e=!1;s.forEach(function(a){t.cID==a.ID&&(e=!0)}),e||s.push(r()(t,{ID:t.cID,IsDelete:1}))}),o)if(i)if(parseFloat(this.form.TotalPrice)<=0)this.$vux.toast.show({type:"warn",text:"成交总额必须大于0"});else if(parseFloat(this.form.TotalPrice)>=1e10)this.$vux.toast.show({type:"warn",text:"成交总额必须小于10000000000"});else{this.senders.forEach(function(t,a){var s=!0,o="";e.oldCheckVal.some(function(e){t.UserID==e.UserID&&(s=!1,o=e.ID)}),e.senders[a].ID=s?0:o}),this.oldCheckVal.forEach(function(t,a){var s=!0;e.senders.some(function(e,a){if(t.ID==e.ID)return s=!1,!0}),s&&e.senders.push({ID:t.ID,isDelete:1,UserID:t.UserID})});var n={ID:this.ID,IsAutoNumber:1,CustomerState:this.form.CustState.ID,Title:this.form.Title,Remark:this.form.Remark,ClientID:this.CustomerID,CustomerID:this.CustomerID,LinkUserID:this.LinkUser[0],CustomerName:this.CustomerName,BeginDate:this.form.BeginDate+" 00:00:00",EndDate:this.form.EndDate+" 00:00:00",DealDate:this.form.DealDate+" 00:00:00",PayType:a,OrderNumber:this.form.orderNumber,TotalPrice:this.form.TotalPrice,OrderState:this.form.OrderState.ID,Prods:s,ImgAttach:this.imgFile,Senders:this.senders};t.post("/Order/SaveOrder",n).then(function(t){if(1===t.data.State){e.$vux.toast.show({text:"保存成功",type:"success"});var a=[];e.senders.forEach(function(t){a.push(t.UserID)}),a.length>0&&e.send(a,t.data.Data),e.$bus.emit("onSave",!0),e.$bus.emit("refreshOrderList"),setTimeout(function(){e.form.Title="",e.setChooseProduct([]),e.form.DealDate="",e.form.BeginDate="",e.form.EndDate="",e.payMethod=[],e.form.CustState=[],e.form.Remark="",e.form.OrderState=[],e.form.TotalPrice=0,e.imgFile=[],e.CustomerName="请选择客户",e.CustomerID="",e.LinkUserID="",e.cLinkman=[],e.LinkUser=[],e.$bus.emit("refreshOrderList"),e.$router.back()},500)}}).catch(function(t){})}else this.$vux.toast.show({type:"warn",text:"产品数量必须小于10000000"});else this.$vux.toast.show({type:"warn",text:"产品数量必须大于0"})}else this.$vux.toast.show({type:"warn",text:"请选择客户状态"});else this.$vux.toast.show({type:"warn",text:"请选择订单状态"});else this.$vux.toast.show({type:"warn",text:"请选择结束时间"});else this.$vux.toast.show({type:"warn",text:"请选择开始时间"});else this.$vux.toast.show({type:"warn",text:"请选择签约时间"});else this.$vux.toast.show({type:"warn",text:"请选择产品"});else this.$vux.toast.show({type:"warn",text:"请选择联系人"});else this.$vux.toast.show({type:"warn",text:"请选择客户"})},showUser:function(){this.chooseCustomer.ID&&this.$router.push("/selectLinkman?id="+this.chooseCustomer.ID)},selectPic:function(){var t=this;if(this.imgFile.length>=5)return this.$vux.toast.show({type:"warn",text:"最多上传五张"}),!1;plus.gallery.pick(function(e){e.files.map(function(e){t.updated(e,1).then(function(e){t.$vux.loading.hide();var a=e.Data[0];a.FileSize=e.FileSize,a.src=api50+"/api/v1/File/DownLoadPic?filePath="+a.FilePath,t.imgFile.push(a)}).catch(function(e){t.$vux.loading.hide();var a=e.ErrorMessage||"上传失败";t.$vux.toast.text(a)})})},function(){},{filter:"image",multiple:!0,maximum:5-this.imgFile.length,system:!1})},updated:function(t,e){var a=this;return new s.a(function(s,o){var r=a.BillFileUrl(e),i=plus.uploader.createUpload(r,{method:"POST",blocksize:10485760},function(t){var e=JSON.parse(t.responseText);1==e.State?(e.FileSize=t.totalSize,s(e)):o(e)}),n=t.substr(t.lastIndexOf("/")+1,t.length-t.lastIndexOf("/"));i.addFile(t,{key:n});var c=0;i.addEventListener("statechanged",function(t,s){if(2!=e&&t.totalSize>10485760)return a.$vux.toast.show({type:"warn",text:"图片大小不超过10M"}),i.abort(),!1;0==c&&a.$vux.loading.show({text:"上传中"}),c++},!1),i.start()})},saveImg:function(t){},delPic:function(t){var e=this;this.$vux.confirm.show({content:"确定删除该图片吗？",onConfirm:function(){e.imgFile.splice(t,1)}})},imgShow:function(t){this.$refs.previewer.show(t)},delProduct:function(t){var e=this.chooseProductData;e.splice(t,1),this.setChooseProduct(e)},getLinkman:function(){var t=this;return new s.a(function(e){t.getAxios("/Customer/GetPagedCustomerLinkManList",{page:1,count:100,customerId:t.CustomerID}).then(function(a){t.cLinkman=[];var s=[];a.Data.List.forEach(function(t){s.push({value:""+t.ID,name:t.LinkName})}),t.cLinkman.push(s),t.LinkUser=[""+t.LinkUserID],e()})})},send:function(t,e){var a=this;t.forEach(function(e,s){e==a.$store.state.CurrentUserID&&t.splice(s,1)});var s={SendUsers:t,EvName:"crm-order",ImgPath:down+"/mdtcrm/CRMOrder.jpg",Title:"订单",Content:"您有一个新的订单",Params:[e]};this.postAxios(api50+"/api/v1/Common/SendSingleEventMsg",s).then(function(t){console.log(t)})},GetOrderInfoByID:function(){var e=this;t.get("/Order/GetOrderInfoByID/"+this.ID).then(function(t){if(1===t.data.State){console.log(t.data);var a=t.data.Data;e.allData=t.data.Data,e.form.Title=a.Title,e.form.orderNumber=a.OrderNumber,e.CustomerName=a.CustomerName,e.$set(e.LinkUser,0,a.LinkUserID+"");var s=[];a.Prods.forEach(function(t){s.push(r()(t,{cID:t.ID,ID:t.OrderProdID}))}),e.setChooseProduct(s),e.CustomerID=a.CustomerID,e.form.DealDate=a.DealDate.replace("00:00:00",""),e.form.BeginDate=a.BeginDate.replace("00:00:00",""),e.form.EndDate=a.EndDate.replace("00:00:00",""),e.$set(e.payMethod,0,e.payment[0][parseInt(a.PayType)-1]),e.OrderStateName=a.OrderStateName,e.form.Remark=a.Remark,e.CustomerStateName=a.CustomerStateName,e.form.CustState={ID:a.CustomerState,DictName:a.CustomerStateName},e.form.OrderState={ID:a.OrderState,DictName:a.OrderStateName},e.ID=a.ID,e.$nextTick(function(){e.form.TotalPrice=t.data.Data.TotalPrice}),e.imgFile=[];for(var o=0;o<t.data.Data.ImgAttach.length;o++){var i=t.data.Data.ImgAttach[o];/.*(gif|png|jpe?g)$/.test(i.FilePath)&&e.imgFile.push(r()(i,{src:api50+"/api/v1/File/DownLoadPic?filePath="+i.FilePath}))}e.sendersName="",t.data.Data.Senders.forEach(function(a){e.senders.push({UserID:a.UserID,IsDelete:0,ID:a.ID}),t.data.Data.Senders.length<2?e.sendersName+=a.Name:e.sendersName+=a.Name+","}),e.checkVal=t.data.Data.Senders,e.oldCheckVal=t.data.Data.Senders}}).catch(function(t){console.log(t)})}})}).call(e,a("mtWM"))},yZFb:function(t,e,a){"use strict";a("AcdC");var s=a("FL0N"),o={render:function(){var t=this,e=t.$createElement;return(t._self._c||e)("popup-picker",{attrs:{title:t.title,data:t.list},on:{"on-show":t.onShow,"on-hide":t.onHide,"on-change":t.onChange},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}})},staticRenderFns:[]};var r=function(t){a("1XKH")},i=a("VU/8")(s.a,o,!1,r,"data-v-76f191d1",null);e.a=i.exports}});
//# sourceMappingURL=9.1ed67f534d62734acc7a.js.map