<!doctype html>
<html id="MdTong">

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="../../css/common.css" />
		<link rel="stylesheet" href="../../icon-font/iconfont.css" />
	</head>
	<style>
		.chosed-eq {
			width: 100%;
			box-sizing: border-box;
			display: block;
			background: #FFFFFF;
			padding: 0 16px;
		}
		
		.choosed-list {
			width: 100%;
			background: #F7F7F7;
			margin: 0 auto;
			box-sizing: border-box;
			padding: 0 8px;
			padding-right: 0;
		}
		
		.choded-title {
			font-size: 1.2rem;
			color: #999999;
			line-height: 2.4rem;
		}
		
		.li-content {
			width: 100%;
			display: flex;
			align-items: center;
			background: #f7f7f7;
			font-size: 1.4rem;
			justify-content: space-between;
		}
		
		.li-content img {
			width: 17px;
			height: 14px;
			vertical-align: middle;
		}
		
		.choosed-list ul {
			background: none;
		}
		
		.icon-delete {
			color: #AEAEAE;
		}
		
		.equ_img {
			width: 35px;
			margin-right: 11px;
		}
		
		.equ_img img {
			width: 35px;
			height: 35px;
			border-radius: 50%;
		}
		
		.equ-info {
			width: 90%;
		}
		
		.equ-name {
			color: #323232;
			font-size: 1.4rem;
		}
		
		.equ-number,
		.equ-location {
			color: #999999;
			font-size: 1.2rem;
			line-height: 15px;
		}
		
		.equ_list_li_left {
			width: 100%;
			display: flex;
			text-align: left;
			align-items: flex-start;
		}
		
		.li-left {
			width: 96%;
			overflow: hidden;
			display: flex;
			align-items: center;
			justify-content: flex-start;
		}
		
		.fill-img {
			width: 17px;
			margin-right: 5px;
		}
		
		.fill-name {
			width: 90%;
			overflow: hidden;
			text-overflow: ellipsis;
			white-space: nowrap;
		}
		
		.choded-title {
			font-size: 1.2rem;
			color: #999999;
			position: relative;
			box-sizing: border-box;
			padding: 0 9px;
			background: #F7F7F7;
		}
		
		.choded-title:after {
			position: absolute;
			left: 0;
			right: 10px;
			bottom: 0;
			height: 1px;
			content: '';
			-webkit-transform: scaleY(0.5);
			transform: scaleY(0.5);
			background-color: #CCCCCC;
			width: 100%;
		}
		
		.data-group .data-row:after {
			position: absolute;
			left: 0;
			right: 0;
			bottom: 0;
			height: 1px;
			content: '';
			-webkit-transform: scaleY(0.5);
			transform: scaleY(0.5);
			background-color: #EAEAEA;
		}
		
		.nomargin-tp {
			margin-top: 0;
		}
		
		.equ_list_li {
			padding: 10px 0;
		}
		
		.hr-block {
			width: 100%;
			height: 5px;
			background: #F1F1F1;
		}
		
		.imgslist {
			float: left;
			width: 55px;
			height: 55px;
			margin-right: 10px;
			background-size: cover!important;
		}
		
		.what-block {
			width: 100%;
			height: 10px;
			background: #fff;
		}
		
		.equ_list_li_last {
			padding: 10px 0!important;
		}
		
		.partDomUl.data-group .data-row .body {
			padding: 0 0 0 16px;
			min-height: auto;
			/*CSS3弹性盒子*/
			display: -ms-flex;
			display: -webkit-flex;
			display: flex;
			-webkit-flex-direction: row;
			-ms-flex-direction: row;
			flex-direction: row;
			-ms-flex-align: center;
			-webkit-align-items: center;
			-webkit-box-align: center;
			align-items: center;
		}
		
		.partDomUl.data-group {
			margin-top: 0px;
		}
		
		.sku-name {
			line-height: 15px;
			color: #AAAAAA!important;
		}
		/*新增配件列表样式*/
		
		div.remarkscontent {
			color: #323232;
			font-size: 1.4rem;
			overflow: hidden;
			text-overflow: ellipsis;
			white-space: nowrap;
			vertical-align: middle;
		}
		/*删除按钮*/
		
		.partDomList .icon-right,
		.partDomList .icon-delete {
			color: #AEAEAE!important;
			padding-left: 10px;
			margin-right: 12px!important;
		}
		
		.mui-row:after {
			display: block;
			position: absolute;
			left: 0px;
			right: 0px;
			top: 0;
			height: 1px;
			content: '';
			-webkit-transform: scaleY(0.5);
			transform: scaleY(0.5);
			background-color: #EAEAEA;
		}
		
		.close {
			padding: 0px!important;
		}
		
		.partDomUl .data-row:after {
			background: #EAEAEA!important;
		}
		
		.mui-table-view-cell {
			padding: 0px;
		}
		
		.partDomUl.data-group .data-row:after {
			left: 0!important;
			right: 0!important;
		}
		
		.width50 {
			width: 50%;
		}
		
		.width30 {
			width: 30%;
		}
		
		.width20 {
			width: 20%;
			text-align: left;
		}
		
		.mui-row:after {
			height: 0;
		}
		
		.partDomHead {
			background: #F1F1F1;
			min-height: auto;
		}
		.mui-ellipsis {
				white-space: nowrap !important;
			}
			
			.equ-title {
				font-size: 1.5rem;
				color: #000000;
			}
			
			.equ-sub {
				line-height: 16px;
				font-size: 1.2rem;
				color: #AAAAAA;
				font-family: MicrosoftYaHei;
			}
			
			.imgslist {
				float: left;
				
				margin-right: 10px;
				background-size: cover !important;
			}
			
			.total {
				text-align: center;
				line-height: 40px;
				color: #3296FA;
			}
			.equ_list_li-pad{
				padding:10px 16px!important;
				
			}
			.left10:after{
				left: 0;
			}
	</style>

	<body ng-controller="PersModController">
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon icon-back mui-pull-left">巡检标准</a>
			<a class="menu-more icon-more right-menu-icon-detail" href="#popover"></a>
		</header>
		<div class="mui-scroll-wrapper md-info-page" ng-class="{'mui-block':isLoad}" style="display: none;">
			<ul class="data-group mt0">
				<li class="data-row">
					<label>巡检标准名称</label>
					<div class="body">
						<span ng-bind="equiMain.Name"></span>
					</div>
				</li>
				<li class="data-row" ng-if="equiMain.EqList.length>0">
					<label>适用设备</label>
				</li>
			</ul>
			<div class="chosed-eq">
				<div class="data-roww-wrap">
					<div class="choosed-list">
						<ul class="data-group nomargin-tp">
							<li class="data-row must pad-10" ng-if="equ.IsEqDir==1" ng-repeat="equ in equiMain.EqList">
								<div class="li-content">
									<div class="li-left">
										<div class="fill-img">
											<img src="../../images/fill.png" />
										</div>
										<div class="fill-name" ng-bind="equ.EqOrDirName"></div>
									</div>

								</div>
							</li>
						</ul>
					</div>
					<div class="hr-block" ng-show="isShowChoosed()"></div>
					<div class="choosed-list mar-bottom">
						<ul class="data-group nomargin-tp">
							<li class="data-row equ_list_li  equ_list_li_last" ng-if="equ.IsEqDir==0" ng-repeat="equ in equiMain.EqList">
								<div class="equ_list_li_left">
									<div class="equ_img">
										<img src="../../images/imgPre.png" ng-style="{'background-image':'url('+ (equ.AttachFilePath | getEquLogo:35) +')'}" class="imgslist" />
									</div>
									<div class="equ-info">
										<div class="equ-name" ng-bind="equ.EqOrDirName"></div>
										<div class="equ-number"><span>型号:</span><span ng-bind="equ.SkuName">:</span></div>
										<div class="equ-location" ng-if="isShowAddress(equ)"><span ng-bind="'位置'+':' + (equ | getEquAddress)"></span></div>
									</div>
								</div>
							</li>
						</ul>
					</div>
					<div class="what-block" ng-show="isShowChoosed2()"></div>
				</div>
			</div>
			<ul class="data-group mt0 mui-table-view mui-table-view-chevron" ng-if="equiMain.EquCount>0">
				<li class="data-row mui-table-view-cell mui-block" ng-click="lookover('insp-equ')">
					<div class="total">合计
						<span ng-bind="equiMain.EquCount"></span> 个设备</div>
				</li>
			</ul>
			<ul class="data-group hastitle" ng-if="equiMain.Items.length!=0">
				<!--ng-if="faultInfoData.IsShowRepair==1&&mainReplace.length>0">-->
				<li class="data-row">
					<label class="title">巡检项目</label>
				</li>
			</ul>
			<ul class="partDomUl data-group">
				<li class="data-row partDomHead" ng-if="equiMain.Items.length!=0">
					<p class="opt md-icon font-15 close">
						<!--<span class="icon-delete partDomIcon" ng-click="delpartListItem(index)"></span>-->
					</p>
					<div class="body mui-grid-view mui-row" style="color: #666!important">
						<div class="mui-media mui-col-xs-6 mui-col-sm-6">点检项名称</div>
						<div class=" mui-media mui-col-xs-1 mui-col-sm-1"></div>
						<div class="mui-media mui-col-xs-5 mui-col-sm-5">记录方式</div>
					</div>
				</li>
				<li class="data-row mui-table-view-cell partDomList" ng-repeat="item in equiMain.Items" ng-click="gotoinfo(item.ID)">
					<p class="opt md-icon font-15 close" style="right: 3px" ng-click="tap(item.ID)">
						<span class="icon-right partDomIcon"></span>
					</p>
					<div class="body mui-grid-view mui-row" ng-click="tap(item.ID)">
						<div class=" mui-media mui-col-xs-6 mui-col-sm-6 mui-ellipsis remarkscontent">
							<span ng-bind="item.ItemName.trim()"></span>
						</div>
						<div class=" mui-media mui-col-xs-1 mui-col-sm-1"></div>
						<div class=" mui-media mui-col-xs-5 mui-col-sm-5 text-left mui-ellipsis remarkscontent" ng-bind="types[item.Type]"></div>

					</div>
				</li>
			</ul>
		</div>
		<!--无网络或请求失败重试-->
		<md-state-tip options="retryModal" ng-show="retryModal.state"></md-state-tip>
		<!-- 修改删除 —— 右上角 -->
		<div id="popover" class="mui-popover menuDivModel">
			<ul class="mui-table-view">
				<li class="mui-table-view-cell" ng-click="edit()">
					<a class="mui-icon icon-edit">
						<font>修改</font>
					</a>
				</li>
				<li class="mui-table-view-cell" ng-click="del()">
					<a class="mui-icon icon-dustbin">
						<font>删除</font>
					</a>
				</li>
			</ul>
		</div>
		<script type="text/javascript" src="../../js/mui.min.js"></script>
		<script type="text/javascript" src="../../js/angular.min.js"></script>
		<script type="text/javascript" src="../../js/common.js"></script>
		<script type="text/javascript" src="../../js/utils.js"></script>
		<script>
			app.controller("PersModController", ["$scope", "$filter", "AuthService", "ApiService", "DataService", "UtilsService", "Loading", "ChatUserService", "RPCObserver", "ShareLogService", "CacheService","$rootScope", function($scope, $filter, AuthService, ApiService, DataService, UtilsService, Loading, ChatUserService, RPCObserver, ShareLogService, CacheService,$rootScope) {
				//无网络或请求失败重试,或已删除
				$scope.retryModal = {
					msg: "设备巡检",
					retry: GetEqOverhaulInfoById,
					state: ''
				}
				var id = query("id") || 0;
				$scope.types = {
					4: '勾选',
					2: '数字 ',
					101: '列表',
					19: '文字描述',
				};
				$scope.isLoad = false;
				//获取巡检数据
				function GetEqOverhaulInfoById() {
					Loading.show();
					var url = ApiService.Api50 + "/api/v1/Equipment/GetEqOverhaulStandardById/" + id;
					DataService.get(url).then(function(res) {
						
						$scope.retryModal.state= "";
						$scope.equiMain = res;
						Loading.hide();
						$scope.isLoad = true;
					}, function(error) {
						$scope.retryModal.state = error.State;
						$scope.isLoad = false;
					});
				};

				GetEqOverhaulInfoById();

				$scope.isShowAddress = function(equ) {
					return trim($filter("getEquAddress")(equ)).length > 0;
				};
				//编辑
				$scope.edit = function() {
					mui('#popover').popover('hide');
					UtilsService.openWindow({
						needLogin: true,
						id: 'insp-rule-edit.html',
						url: 'insp-rule-edit.html?id=' + id
					});
				};

				//删除
				$scope.del = function() {
					mui('#popover').popover('hide');
					mui.confirm("确认删除吗？", function(e) {
						if(e.index == 0) {
							var url = ApiService.Api50 + "/api/v1/Equipment/DeleteEqOverhaulStandardById/" + id;
							DataService.get(url).then(function() {
								RPCObserver.broadcast('refresh_insp_rule_list');
								mui.back();
							});
						}
					});
				};
                   /*var mui_back = mui.back;
					mui.back = function() {
						RPCObserver.broadcast('refresh_insp_rule_list')
						mui_back()
					};*/
				$scope.isShowChoosed = function() {
					return $scope.equiMain && $scope.equiMain.EqList.some(function(_item) {
						return _item.IsEqDir == 0;
					}) && $scope.equiMain.EqList.some(function(_item) {
						return _item.IsEqDir == 1;
					});
				}

				$scope.isShowChoosed2 = function() {
					return $scope.equiMain && ($scope.equiMain.EqList.some(function(_item) {
						return _item.IsEqDir == 0;
					}) || $scope.equiMain.EqList.some(function(_item) {
						return _item.IsEqDir == 1;
					}));
				}

				//项目
				$scope.gotoinfo = function(item) {
					UtilsService.openWindow({
						needLogin: true,
						id: 'insp-rule-item-info.html',
						url: 'insp-rule-item-info.html?id=' + item
					});
				};
					//跳转到相应的页面
					$scope.tap = function(href, obj) {
						$rootScope.$broadcast("stop_audio");
						openWindow(href + "?equid=" + obj.ID);
					};

					$scope.lookover = function(key) {
						var url = "../../pages/aftersale/customer-datas.html?key=" + key + "&id=" + id
						var title = "设备列表" ;
						openWindow("../common/hyperlink.html", {
							hyperlink: {
								title: title,
								url: url
							}
						}, "hyperlink.html");
					};

				// 更新数据
				RPCObserver.on('refresh_insp_rule_lnfo', 'refresh_insp_rule_lnfo');
				window.refresh_insp_rule_lnfo = GetEqOverhaulInfoById;

				//刷新关闭popover
				RPCObserver.on('close_popover', 'close_popover');
				window.close_popover = function() {
					mui('#popover').popover('hide');
				};
			}]);

			// 初始化
			mui.plusReady(function() {
				angular.bootstrap(document.getElementById("MdTong"), ["MdTong"]);
			});
		</script>
	</body>

</html>