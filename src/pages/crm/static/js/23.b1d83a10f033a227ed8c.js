webpackJsonp([23],{C74A:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("//Fk"),s=a.n(i),o=a("woOf"),r=a.n(o),n=a("mvHQ"),l=a.n(n),c=a("Dd8w"),u=a.n(c),h=a("oqQY"),f=a.n(h),d=a("NYxO"),p=a("ABCa"),m=a("rHil"),v=a("1DHf"),D=a("pDNl"),w=a("UNGY"),x=a("7TQh"),g=a("7Ah8"),C=a("ALGc"),F=a("2sLL"),S=a("2FOq"),y=a("M/Ia"),I=a("oveD"),$=a("BPFO"),k=a("lzuW"),P=(k.a,u()({selectUser:function(){this.userShow=!0},userSelected:function(t){this.checkVal=t.map(function(t){return{UserID:t.ID,Name:t.OrgName}}),this.userList=JSON.parse(l()(t)),this.userShow=!1,this.userList.map(function(t){t.userID=t.ID||t.userID,t.Name=t.OrgName})},selectedClient:function(t){this.formData.CustomerState=t.CustState}},Object(d.b)(["initDictPromise"]),{selectCust:function(){if(!this.isSelectCust)return!1;this.$router.push({path:"/addFollow/selectCust"})},saveImg:function(t){},confirmDate:function(){},selectType:function(){},getData:function(){var t=this;this.getAxios("/Customer/GetCustomerFollowupByID/"+this.fId).then(function(e){t.isSave=!0,t.formData=u()({},e.Data),t.formData.FollowupDate=f()(t.formData.FollowupDate).format("YYYY-MM-DD HH:mm"),t.formData.ImgAttach.forEach(function(e){e.src=api50+"/api/v1/File/DownLoadPic?filePath="+e.FilePath,t.imgFile.push(e)}),t.recordFile=t.formData.AmrAttach||{},t.formData.Senders.forEach(function(t){t.userID=t.UserID}),t.userList=JSON.parse(l()(t.formData.Senders)),t.checkVal=JSON.parse(l()(t.formData.Senders))})},save:function(){var t=this,e=r()({},this.formData),a=this.$refs.client.getData();return e.CustomerID=a.CustomerID,e.LinkUserID=a.LinkUserID,e.ImgAttach=this.imgFile,this.recordFile.FilePath?e.AmrAttach=this.recordFile:delete e.AmrAttach,e.AmrAttach&&(e.IsHasAudio=1,e.AudioLength=e.AmrAttach.FileSize),e.CustomerID?e.FollowupDate?e.FollowupState?e.CustomerState?(e.FollowupDate+=":00",this.formData.Senders.forEach(function(e,a){t.userList.find(function(t){return t.userID==e.UserID})||(e.IsDelete=1)}),this.userList.forEach(function(e){t.formData.Senders.find(function(t){return e.userID==t.UserID})||t.formData.Senders.push({ID:0,UserID:e.userID,IsDelete:0})}),!(this.clickNum>0)&&(this.clickNum+=1,void this.postAxios("/Customer/SaveFollowUp",e).then(function(e){t.$vux.toast.show({type:"success",text:"保存成功"}),t.$bus.emit("onSave",!0),t.$bus.emit("refrech",!0),t.$route.meta.isBack=!0;var a=[];t.formData.Senders.forEach(function(e){t.$store.state.CurrentUserID!=e.UserID&&0==e.ID&&a.push(e.UserID)}),t.send(a,e.Data),t.isSave=!0,t.$router.back()}).catch(function(e){t.clickNum=0}))):(this.$vux.toast.show({text:"请选择客户状态",type:"warn"}),!1):(this.$vux.toast.show({text:"请选择跟进阶段",type:"warn"}),!1):(this.$vux.toast.show({text:"请选择跟进时间",type:"warn"}),!1):(this.$vux.toast.show({text:"请选择客户",type:"warn"}),!1)},send:function(t,e){var a={SendUsers:t,EvName:"crm-follow",ImgPath:down+"/mdtcrm/CRMFollow.jpg",Title:"跟进记录",Content:"您有一条跟进记录",Params:[e]};this.postAxios(api50+"/api/v1/Common/SendSingleEventMsg",a).then(function(t){})},getCamera:function(){var t=this;if(this.imgFile.length>=5)return this.$vux.toast.show({type:"warn",text:"最多上传五张"}),!1;plus.camera.getCamera().captureImage(function(e){t.updated(e,1).then(function(e,a){t.$vux.loading.hide();var i=e.Data[0];i.FileSize=e.FileSize,i.src=api50+"/api/v1/File/DownLoadPic?filePath="+i.FilePath,t.imgFile.push(i)}).catch(function(e){t.$vux.loading.hide();var a=e.ErrorMessage||"上传失败";t.$vux.toast.text(a)})})},selectPic:function(){var t=this;if(this.imgFile.length>=5)return this.$vux.toast.show({type:"warn",text:"最多上传五张"}),!1;plus.gallery.pick(function(e){e.files.map(function(e){t.updated(e,1).then(function(e){t.$vux.loading.hide();var a=e.Data[0];a.FileSize=e.FileSize,a.src=api50+"/api/v1/File/DownLoadPic?filePath="+a.FilePath,t.imgFile.push(a)}).catch(function(e){t.$vux.loading.hide();var a=e.ErrorMessage||"上传失败";t.$vux.toast.text(a)})})},function(){},{filter:"image",multiple:!0,maximum:5-this.imgFile.length,system:!1})},delPic:function(t){var e=this;this.$vux.confirm.show({content:"确定删除该图片？",onConfirm:function(){e.imgFile.splice(t,1)}})},delRec:function(){var t=this;this.$vux.confirm.show({content:"确定删除该录音？",onConfirm:function(){t.recordFile={}}})},getRecord:function(t){var e=this;t.preventDefault();var a=+new Date;this.isRecord=!0,this.recorderTimer=setTimeout(function(){e.$vux.toast.text("最长只能录制60秒！"),e.stopRecord()},59e3),this.recorder.record({filename:"_doc/audio/",format:"amr"},function(t){var i=+new Date;if(i-a<1e3)e.$vux.toast.text("录音时间太短，请长按录音");else{var s=Math.ceil((i-a)/1e3);e.updated(t,2).then(function(a){e.$vux.loading.hide();var i=a.Data[0];i.FileSize=s,i.path=t,e.recordFile=i}).catch(function(t){e.$vux.loading.hide();var a=t.ErrorMessage||"上传失败";e.$vux.toast.text(a)})}},function(t){console.log(t)})},stopRecord:function(){clearTimeout(this.recorderTimer),this.isRecord=!1,this.recorder.stop()},handleRecord:function(t,e){var a=this;e?this.playRecord(e):this.download(t,"_doc/audio/").then(function(t){return a.playRecord(t)})},playRecord:function(t){var e=this;if(this.player)return this.player.stop(),this.player=null,!1;this.player=plus.audio.createPlayer(t),this.player.play(function(){e.player.stop(),e.player=null},function(t){e.player.stop(),e.player=null})},updated:function(t,e){var a=this;return new s.a(function(i,s){var o=a.BillFileUrl(e),r=plus.uploader.createUpload(o,{method:"POST",blocksize:10485760},function(t){var e=JSON.parse(t.responseText);1==e.State?(e.FileSize=t.totalSize,i(e)):s(e)}),n=t.substr(t.lastIndexOf("/")+1,t.length-t.lastIndexOf("/"));r.addFile(t,{key:n});var l=0;r.addEventListener("statechanged",function(t,i){if(2!=e&&t.totalSize>10485760)return a.$vux.toast.show({type:"warn",text:"图片大小不超过10M"}),r.abort(),!1;0==l&&a.$vux.loading.show({text:"上传中"}),l++},!1),r.start()})},download:function(t,e,a){return new s.a(function(i,s){var o=a||api50+"/api/v1/File/DownLoadFile?filePath="+t;plus.downloader.createDownload(o,{filename:e},function(t,e){200==e?i(t.filename):s()}).start()})}}),u()({},Object(d.e)(["dict"])),p.a,m.a,v.a,D.a,w.a,x.a,g.a,C.a,F.a,S.a,y.a,I.a,$.a,{mixins:[k.a],data:function(){return{options:{saveImg:function(t){}},formData:{CustomerID:"",LinkUserID:"",FollowupDate:f()(new Date).format("YYYY-MM-DD HH:mm"),ContactType:0,FollowupState:0,ResultContent:"",ID:0,CustomerState:0,Senders:[]},FollowupState:[],LinkUserName:"",types:[{key:0,value:"电话联系"},{key:1,value:"上门拜访"},{key:2,value:"微信联系"}],isUserShow:!1,cState:[],recorder:{},player:{},recorderTimer:{},isRecord:!1,recordFile:{},imgFile:[],isPlay:!1,fId:0,isSelectCust:!0,isInit:!1,clickNum:0,userShow:!1,userList:[],checkVal:[],isSave:!1}},mounted:function(){var t=this.$route.query;this.isSelectCust=!Boolean(t.cId),this.formData.CustomerID=t.cId,this.formData.CustomerName=t.cName,this.formData.LinkUserID=t.cLink,this.formData.CustomerState=t.cState,this.fId=t.id,this.fId&&this.getData(),this.recorder=plus.audio.getRecorder(),this.player=null},beforeRouteLeave:function(t,e,a){this.$bus.off("selectedClient"),"/TaskWork"===t.fullPath&&(t.meta.keepAlive=!0),this.isSave||!this.formData.CustomerID&&!this.formData.ResultContent?a():this.$vux.confirm.show({title:"继续退出？",content:"您已编辑过，退出将丢失这些内容！",onCancel:function(){a(!1)},onConfirm:function(){a()}})},methods:u()({selectUser:function(){this.userShow=!0},userSelected:function(t){this.checkVal=t.map(function(t){return{UserID:t.ID,Name:t.OrgName}}),this.userList=JSON.parse(l()(t)),this.userShow=!1,this.userList.map(function(t){t.userID=t.ID||t.userID,t.Name=t.OrgName})},selectedClient:function(t){this.formData.CustomerState=t.CustState}},Object(d.b)(["initDictPromise"]),{selectCust:function(){if(!this.isSelectCust)return!1;this.$router.push({path:"/addFollow/selectCust"})},saveImg:function(t){},confirmDate:function(){},selectType:function(){},getData:function(){var t=this;this.getAxios("/Customer/GetCustomerFollowupByID/"+this.fId).then(function(e){t.isSave=!0,t.formData=u()({},e.Data),t.formData.FollowupDate=f()(t.formData.FollowupDate).format("YYYY-MM-DD HH:mm"),t.formData.ImgAttach.forEach(function(e){e.src=api50+"/api/v1/File/DownLoadPic?filePath="+e.FilePath,t.imgFile.push(e)}),t.recordFile=t.formData.AmrAttach||{},t.formData.Senders.forEach(function(t){t.userID=t.UserID}),t.userList=JSON.parse(l()(t.formData.Senders)),t.checkVal=JSON.parse(l()(t.formData.Senders))})},save:function(){var t=this,e=r()({},this.formData),a=this.$refs.client.getData();return e.CustomerID=a.CustomerID,e.LinkUserID=a.LinkUserID,e.ImgAttach=this.imgFile,this.recordFile.FilePath?e.AmrAttach=this.recordFile:delete e.AmrAttach,e.AmrAttach&&(e.IsHasAudio=1,e.AudioLength=e.AmrAttach.FileSize),e.CustomerID?e.FollowupDate?e.FollowupState?e.CustomerState?(e.FollowupDate+=":00",this.formData.Senders.forEach(function(e,a){t.userList.find(function(t){return t.userID==e.UserID})||(e.IsDelete=1)}),this.userList.forEach(function(e){t.formData.Senders.find(function(t){return e.userID==t.UserID})||t.formData.Senders.push({ID:0,UserID:e.userID,IsDelete:0})}),!(this.clickNum>0)&&(this.clickNum+=1,void this.postAxios("/Customer/SaveFollowUp",e).then(function(e){t.$vux.toast.show({type:"success",text:"保存成功"}),t.$bus.emit("onSave",!0),t.$bus.emit("refrech",!0),t.$route.meta.isBack=!0;var a=[];t.formData.Senders.forEach(function(e){t.$store.state.CurrentUserID!=e.UserID&&0==e.ID&&a.push(e.UserID)}),t.send(a,e.Data),t.isSave=!0,t.$router.back()}).catch(function(e){t.clickNum=0}))):(this.$vux.toast.show({text:"请选择客户状态",type:"warn"}),!1):(this.$vux.toast.show({text:"请选择跟进阶段",type:"warn"}),!1):(this.$vux.toast.show({text:"请选择跟进时间",type:"warn"}),!1):(this.$vux.toast.show({text:"请选择客户",type:"warn"}),!1)},send:function(t,e){var a={SendUsers:t,EvName:"crm-follow",ImgPath:down+"/mdtcrm/CRMFollow.jpg",Title:"跟进记录",Content:"您有一条跟进记录",Params:[e]};this.postAxios(api50+"/api/v1/Common/SendSingleEventMsg",a).then(function(t){})},getCamera:function(){var t=this;if(this.imgFile.length>=5)return this.$vux.toast.show({type:"warn",text:"最多上传五张"}),!1;plus.camera.getCamera().captureImage(function(e){t.updated(e,1).then(function(e,a){t.$vux.loading.hide();var i=e.Data[0];i.FileSize=e.FileSize,i.src=api50+"/api/v1/File/DownLoadPic?filePath="+i.FilePath,t.imgFile.push(i)}).catch(function(e){t.$vux.loading.hide();var a=e.ErrorMessage||"上传失败";t.$vux.toast.text(a)})})},selectPic:function(){var t=this;if(this.imgFile.length>=5)return this.$vux.toast.show({type:"warn",text:"最多上传五张"}),!1;plus.gallery.pick(function(e){e.files.map(function(e){t.updated(e,1).then(function(e){t.$vux.loading.hide();var a=e.Data[0];a.FileSize=e.FileSize,a.src=api50+"/api/v1/File/DownLoadPic?filePath="+a.FilePath,t.imgFile.push(a)}).catch(function(e){t.$vux.loading.hide();var a=e.ErrorMessage||"上传失败";t.$vux.toast.text(a)})})},function(){},{filter:"image",multiple:!0,maximum:5-this.imgFile.length,system:!1})},delPic:function(t){var e=this;this.$vux.confirm.show({content:"确定删除该图片？",onConfirm:function(){e.imgFile.splice(t,1)}})},delRec:function(){var t=this;this.$vux.confirm.show({content:"确定删除该录音？",onConfirm:function(){t.recordFile={}}})},getRecord:function(t){var e=this;t.preventDefault();var a=+new Date;this.isRecord=!0,this.recorderTimer=setTimeout(function(){e.$vux.toast.text("最长只能录制60秒！"),e.stopRecord()},59e3),this.recorder.record({filename:"_doc/audio/",format:"amr"},function(t){var i=+new Date;if(i-a<1e3)e.$vux.toast.text("录音时间太短，请长按录音");else{var s=Math.ceil((i-a)/1e3);e.updated(t,2).then(function(a){e.$vux.loading.hide();var i=a.Data[0];i.FileSize=s,i.path=t,e.recordFile=i}).catch(function(t){e.$vux.loading.hide();var a=t.ErrorMessage||"上传失败";e.$vux.toast.text(a)})}},function(t){console.log(t)})},stopRecord:function(){clearTimeout(this.recorderTimer),this.isRecord=!1,this.recorder.stop()},handleRecord:function(t,e){var a=this;e?this.playRecord(e):this.download(t,"_doc/audio/").then(function(t){return a.playRecord(t)})},playRecord:function(t){var e=this;if(this.player)return this.player.stop(),this.player=null,!1;this.player=plus.audio.createPlayer(t),this.player.play(function(){e.player.stop(),e.player=null},function(t){e.player.stop(),e.player=null})},updated:function(t,e){var a=this;return new s.a(function(i,s){var o=a.BillFileUrl(e),r=plus.uploader.createUpload(o,{method:"POST",blocksize:10485760},function(t){var e=JSON.parse(t.responseText);1==e.State?(e.FileSize=t.totalSize,i(e)):s(e)}),n=t.substr(t.lastIndexOf("/")+1,t.length-t.lastIndexOf("/"));r.addFile(t,{key:n});var l=0;r.addEventListener("statechanged",function(t,i){if(2!=e&&t.totalSize>10485760)return a.$vux.toast.show({type:"warn",text:"图片大小不超过10M"}),r.abort(),!1;0==l&&a.$vux.loading.show({text:"上传中"}),l++},!1),r.start()})},download:function(t,e,a){return new s.a(function(i,s){var o=a||api50+"/api/v1/File/DownLoadFile?filePath="+t;plus.downloader.createDownload(o,{filename:e},function(t,e){200==e?i(t.filename):s()}).start()})}}),filters:{picUrl:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return api50+"/api/v1/File/DownLoadPic?filePath="+t+"&w="+e+"&h="+a}},computed:u()({},Object(d.e)(["dict"])),components:{XHeader:p.a,Group:m.a,Cell:v.a,XInput:D.a,Datetime:w.a,PopupRadio:x.a,PopupPicker:g.a,XTextarea:C.a,XButton:F.a,Previewer:S.a,ClientLink:y.a,Dict:I.a,UserSelect:$.a}}),_={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("transition",{attrs:{name:"slide"}},[a("div",{staticClass:"addFollow"},[a("x-header",{attrs:{"left-options":{backText:""}}},[t._v(t._s(t.fId?"修改":"新建")+"跟进记录")]),t._v(" "),a("div",{staticClass:"form pt48"},[a("group",[a("client-link",{ref:"client",attrs:{isSelect:t.isSelectCust,path:"addFollow/selectCust",data:t.formData,reqLink:!1},on:{selectedClient:t.selectedClient}}),t._v(" "),a("div",{staticClass:"cellWrap"},[a("datetime",{attrs:{placeholder:"请选择跟进时间",format:"YYYY-MM-DD HH:mm"},on:{"on-confirm":t.confirmDate},model:{value:t.formData.FollowupDate,callback:function(e){t.$set(t.formData,"FollowupDate",e)},expression:"formData.FollowupDate"}},[a("div",{staticClass:"label",attrs:{slot:"title"},slot:"title"},[a("span",{staticStyle:{color:"red"}},[t._v("*")]),t._v("跟进时间\n            ")])])],1),t._v(" "),a("div",{staticClass:"cellWrap"},[a("popup-radio",{attrs:{title:"联系方式",placeholder:"请选择联系方式",options:t.types},model:{value:t.formData.ContactType,callback:function(e){t.$set(t.formData,"ContactType",e)},expression:"formData.ContactType"}},[a("span",{staticStyle:{color:"#f00"},attrs:{slot:"icon"},slot:"icon"},[t._v("*")]),t._v(" "),a("p",{staticClass:"radioTitle",attrs:{slot:"popup-header"},slot:"popup-header"},[t._v("选择联系方式")])])],1),t._v(" "),a("div",{staticClass:"cellWrap"},[a("dict",{attrs:{type:"4",title:"跟进阶段",placeholder:"请选择跟进阶段"},model:{value:t.formData.FollowupState,callback:function(e){t.$set(t.formData,"FollowupState",e)},expression:"formData.FollowupState"}})],1),t._v(" "),a("div",{staticClass:"cellWrap"},[a("dict",{attrs:{type:"5",title:"客户状态",placeholder:"请选择客户状态"},model:{value:t.formData.CustomerState,callback:function(e){t.$set(t.formData,"CustomerState",e)},expression:"formData.CustomerState"}})],1),t._v(" "),a("div",{staticClass:"cellWrap"},[a("cell",{attrs:{title:"选择抄送人","is-link":""},nativeOn:{click:function(e){return t.selectUser(e)}}},[t._l(t.userList,function(e,i){return a("span",{key:i},[t._v(t._s(e.Name)+t._s(i+1==t.userList.length?"":","))])})],2)],1)],1),t._v(" "),a("group",{staticStyle:{"margin-bottom":"44px"}},[a("div",{staticClass:"cellWrap"},[a("x-textarea",{attrs:{required:"",placeholder:"请填写跟进结果",max:1e3},model:{value:t.formData.ResultContent,callback:function(e){t.$set(t.formData,"ResultContent","string"==typeof e?e.trim():e)},expression:"formData.ResultContent"}})],1),t._v(" "),a("div",{staticClass:"update"},[a("div",{staticClass:"updatePic flex"},t._l(t.imgFile,function(e,i){return a("div",{key:i,staticClass:"picBoxWrap"},[a("div",{staticClass:"picBox"},[a("img",{attrs:{src:t._f("picUrl")(e.FilePath)},on:{click:function(e){t.imgShowPic(i)}}})]),t._v(" "),a("svg",{staticClass:"vux-x-icon vux-x-icon-ios-minus close",attrs:{type:"ios-minus",size:"25",xmlns:"http://www.w3.org/2000/svg",width:"25",height:"25",viewBox:"0 0 512 512"},on:{click:function(e){t.delPic(i)}}},[a("path",{attrs:{d:"M256 48C141.1 48 48 141.1 48 256s93.1 208 208 208 208-93.1 208-208S370.9 48 256 48zm128 217H128v-17h256v17z"}})])])})),t._v(" "),t.recordFile.FilePath?a("div",{staticClass:"updateRec flex"},[a("div",{staticClass:"recBox",on:{click:function(e){t.handleRecord(t.recordFile.FilePath,t.recordFile.path)}}},[a("span",{directives:[{name:"show",rawName:"v-show",value:!t.player,expression:"!player"}],staticClass:"stopRec"}),t._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:t.player,expression:"player"}],staticClass:"playRec"}),t._v("\n              "+t._s(t.recordFile.FileSize)+"s\n            ")]),t._v(" "),a("svg",{staticClass:"vux-x-icon vux-x-icon-ios-close-outline fileClose",attrs:{type:"ios-close-outline",size:"18",id:"Layer_1",xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 512 512"},on:{click:t.delRec}},[a("path",{staticClass:"st0",attrs:{d:"M403.1 108.9c-81.2-81.2-212.9-81.2-294.2 0s-81.2 212.9 0 294.2c81.2 81.2 212.9 81.2 294.2 0s81.2-213 0-294.2zm-12.3 281.9c-74.3 74.3-195.3 74.3-269.6 0-74.3-74.3-74.3-195.3 0-269.6s195.3-74.3 269.6 0c74.4 74.3 74.4 195.3 0 269.6z"}}),a("path",{staticClass:"st0",attrs:{d:"M340.2 160l-84.4 84.2-84-83.8-11.8 11.8 84 83.8-84 83.8 11.8 11.8 84-83.8 84.4 84.2 11.8-11.8-84.4-84.2 84.4-84.2z"}})])]):t._e(),t._v(" "),a("p",{staticClass:"flex"},[a("i",{staticClass:"flex-1 iconfont icon-paizhao",on:{click:t.getCamera}}),t._v(" "),a("i",{staticClass:"flex-1 iconfont icon-zhaopian",on:{click:t.selectPic}}),t._v(" "),a("i",{staticClass:"flex-1 iconfont icon-luyin",on:{touchstart:function(e){t.getRecord(e)},touchend:t.stopRecord}})])])]),t._v(" "),a("div",{staticClass:"saveBtn"},[a("x-button",{attrs:{type:"primary"},nativeOn:{click:function(e){return t.save(e)}}},[t._v("提交")])],1)],1),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.isRecord,expression:"isRecord"}],staticClass:"rprogress"},[a("div",{staticClass:"rschedule"}),t._v(" "),a("div",{staticClass:"r-sigh"},[t._v("!")]),t._v(" "),a("div",{staticClass:"rsalert",staticStyle:{"font-size":"12px"}},[t._v("正在录音，请讲话")])]),t._v(" "),a("previewer",{ref:"previewer",attrs:{list:t.imgFile,options:t.options},on:{"on-close":t.closePic}}),t._v(" "),a("router-view",{staticClass:"selectCust"}),t._v(" "),a("user-select",{attrs:{show:t.userShow,title:"选择抄送人",defaultUser:t.checkVal},on:{save:t.userSelected,close:function(e){t.userShow=!1}}})],1)])},staticRenderFns:[]};var L=a("VU/8")(P,_,!1,function(t){a("isS9")},"data-v-7cea555a",null);e.default=L.exports},isS9:function(t,e){}});
//# sourceMappingURL=23.b1d83a10f033a227ed8c.js.map